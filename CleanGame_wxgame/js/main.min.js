var egret=window.egret,__reflect=this&&this.__reflect||function(e,t,i){e.__class__=t,i?i.push(t):i=[t],e.__types__=e.__types__?i.concat(e.__types__):i},__extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);i.prototype=t.prototype,e.prototype=new i},__awaiter=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))(function(r,o){function a(e){try{l(n.next(e))}catch(t){o(t)}}function s(e){try{l(n["throw"](e))}catch(t){o(t)}}function l(e){e.done?r(e.value):new i(function(t){t(e.value)}).then(a,s)}l((n=n.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function i(e){return function(t){return n([e,t])}}function n(i){if(r)throw new TypeError("Generator is already executing.");for(;l;)try{if(r=1,o&&(a=o[2&i[0]?"return":i[0]?"throw":"next"])&&!(a=a.call(o,i[1])).done)return a;switch(o=0,a&&(i=[0,a.value]),i[0]){case 0:case 1:a=i;break;case 4:return l.label++,{value:i[1],done:!1};case 5:l.label++,o=i[1],i=[0];continue;case 7:i=l.ops.pop(),l.trys.pop();continue;default:if(a=l.trys,!(a=a.length>0&&a[a.length-1])&&(6===i[0]||2===i[0])){l=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){l.label=i[1];break}if(6===i[0]&&l.label<a[1]){l.label=a[1],a=i;break}if(a&&l.label<a[2]){l.label=a[2],l.ops.push(i);break}a[2]&&l.ops.pop(),l.trys.pop();continue}i=t.call(e,l)}catch(n){i=[6,n],o=0}finally{r=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var r,o,a,s,l={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},tiled;!function(e){var t=function(e){function t(t,i,n){var r=e.call(this)||this;return r._tilemap=t,r._data=i,r._z=n,r}return __extends(t,e),Object.defineProperty(t.prototype,"tilemap",{get:function(){return this._tilemap},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"z",{get:function(){return this._z},enumerable:!0,configurable:!0}),t.prototype.draw=function(e){},t}(egret.Sprite);e.TMXLayerBase=t,__reflect(t.prototype,"tiled.TMXLayerBase",["tiled.ILayer"])}(tiled||(tiled={}));var tiled;!function(e){var t=function(){function e(e,t,i,n){this.rows=e,this.cols=t,this.tilewidth=i,this.tileheight=n,this.animationTiles=[]}return e.prototype.canRender=function(e){return this.cols===e.cols&&this.rows===e.rows&&this.tilewidth===e.tilewidth&&this.tileheight===e.tileheight},e.prototype.drawTileLayer=function(e,t){},e.prototype.drawTile=function(e,t,i,n){},e.prototype.render=function(e){if(this.animationTiles)for(var t=egret.getTimer(),i=0;i<this.animationTiles.length;i++){var n=this.animationTiles[i],r=n.tmxTile,o=n.pos,a=r.animation,s=a.currentAnimationFrame;void 0==a.oldTime&&(a.oldTime=0),t-a.oldTime>s.duration&&(a.oldBitmap&&a.oldBitmap.parent&&a.oldBitmap.parent.removeChild(a.oldBitmap),this.drawTile(e,o[0],o[1],s.tile),a.oldBitmap=s.tile.bitmap,a.oldTime=t,a.render())}},e}();e.TMXRenderer=t,__reflect(t.prototype,"tiled.TMXRenderer")}(tiled||(tiled={}));var Cell=function(e){function t(t){var i=e.call(this)||this;return i.id=0,i.row=0,i.column=0,i.moveFlag=!1,i.checkFlag=!1,i.sprite=null,i.isAction=!1,i.isSelected=!1,i.moveSpeed=400,i.id=t,i.sprite=new eui.Image,i.addChild(i.sprite),i.addEventListener(egret.Event.ADDED_TO_STAGE,i.addStage,i),i}return __extends(t,e),t.prototype.addStage=function(){this.init()},t.prototype.init=function(){var e=["num1_png","num2_png","num3_png","num4_png","num5_png"];e=["game_Apple_png","game_Blueberry_png","game_Grape_png","game_Lemon_png","game_Watermelon_png"];var i=e[this.id-1],n=RES.getRes(i);n&&(this.width=t.CellWidth,this.height=t.CellHeight,this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2,this.sprite.source=n,this.sprite.width=t.CellWidth,this.sprite.height=t.CellHeight,this.sprite.anchorOffsetX=this.sprite.width/2,this.sprite.anchorOffsetY=this.sprite.height/2,this.sprite.x=this.width/2,this.sprite.y=this.height/2)},t.prototype.initTouch=function(){this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBegan,this),this.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMove,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.onEnd,this)},t.prototype.onBegan=function(){egret.log("Cell Touch Began")},t.prototype.noticeAction=function(){egret.Tween.removeTweens(this);var e=egret.Tween.get(this,{loop:!0});e.to({scaleX:.8,scaleY:.8},300).to({scaleX:1,scaleY:1},300)},t.prototype.setSelect=function(e){this.isSelected!=e&&(this.isSelected=e,e&&this.runSelectedAni())},t.prototype.runSelectedAni=function(){if(0==this.isAction){this.isAction=!0,SoundsMgr.clickCell(),egret.Tween.removeTweens(this);var e=egret.Tween.get(this);e.to({scaleX:.8,scaleY:1.3},100,egret.Ease.bounceIn).to({scaleX:1.1,scaleY:1},100,egret.Ease.bounceOut).to({scaleX:1,scaleY:1},100,egret.Ease.backIn).call(function(){this.isAction=!1},this)}},t.prototype.onMove=function(){},t.prototype.onEnd=function(){},t.prototype.clean=function(){Util.removeByElements(CellMgr.cleanList,this),CellMgr.cleanCell(this);var e=egret.Tween.get(this);e.to({scaleX:.4,scaleY:.4},200).call(function(){this.sendCleanOverEvent()},this).wait(50).call(function(e){this.parent?this.parent.removeChild(this):egret.log("no parent")},this,[this])},t.prototype.sendCleanOverEvent=function(){var e=new GameEvent(GameEvent.CleanOver);this.dispatchEvent(e)},t.prototype.getDistance=function(e,t){var i=Math.pow(t.x-e.x,2),n=Math.pow(t.y-e.y,2),r=Math.sqrt(i+n);return r},t.prototype.drop=function(e,t){var i=CellMgr.getCellPosX(t),n=CellMgr.getCellPosY(e),r=this.getDistance({x:this.x,y:this.y},{x:i,y:n}),o=r/this.moveSpeed*1e3;this.moveFlag=!0,CellMgr.setCell(this,e,t);var a=egret.Tween.get(this);a.to({x:i,y:n},o,egret.Ease.bounceOut).call(function(){this.moveFlag=!1,this.sendDropOverEvent()},this)},t.prototype.sendDropOverEvent=function(){var e=new GameEvent(GameEvent.DropOver);this.dispatchEvent(e)},t.CellWidth=60,t.CellHeight=60,t}(egret.Sprite);__reflect(Cell.prototype,"Cell");var DebugPlatform=function(){function e(){}return e.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,{nickName:"username"}]})})},e.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ThemeAdapter=function(){function e(){}return e.prototype.getTheme=function(e,t,i,n){function r(e){t.call(n,e)}function o(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),i.call(n))}var a=this;"undefined"!=typeof generateEUI?egret.callLater(function(){t.call(n,generateEUI)},this):"undefined"!=typeof generateEUI2?RES.getResByUrl("resource/gameEui.json",function(e,i){window.JSONParseClass.setData(e),egret.callLater(function(){t.call(n,generateEUI2)},a)},this,RES.ResourceItem.TYPE_JSON):(RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),RES.getResByUrl(e,r,this,RES.ResourceItem.TYPE_TEXT))},e}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var CfgFileMgr=function(){function e(){}return e.getLvCfgDatayId=function(e){var t=Util.formatString(["%04s",e]),i=RES.getRes("lvcfg_json");for(var n in i){var r=i[n],o=r.id;if(o==t.toString())return r}return null},e}();__reflect(CfgFileMgr.prototype,"CfgFileMgr");var PlayerData=function(){function e(){}return e.saveLv=function(e){e>=this.data.fightLv&&(this.data.fightLv=e),this.save()},e.initData=function(){var e=egret.localStorage.getItem("gameLocalData");e&&(this.data=JSON.parse(e))},e.save=function(){var e=JSON.stringify(this.data);egret.localStorage.setItem("gameLocalData",e)},e.data={fightLv:"1",gold:0,heart:0},e}();__reflect(PlayerData.prototype,"PlayerData");var SceneMgr=function(){function e(){}return e.gotoLogoin=function(){var t=new ResLoading;Director.getInstance().pushScene(t);var i=(new CallBackFunc).handler(e.onLogo,this,[]);t.load(["com","fruit","logoin","mp3"],i)},e.onLogo=function(){var e=new Logoin;Director.getInstance().repleaceScene(e)},e.gotoIndex=function(){var t=new ResLoading;Director.getInstance().pushScene(t);var i=(new CallBackFunc).handler(e.onIndex,this,[]);t.load(["map","index","json"],i)},e.onIndex=function(){var e=new IndexScene;Director.getInstance().repleaceScene(e)},e.gotoGame=function(){var t=new ResLoading;Director.getInstance().pushScene(t);var i=(new CallBackFunc).handler(e.onGame,this,[]);t.load(["cell","fruit","json"],i)},e.onGame=function(){var e=new GameScene;Director.getInstance().repleaceScene(e)},e.rePlayLv=function(){GameData.curScore=0,GameData.curStep=GameData.targetStep,GameData.isOver=!1,GameData.isWin=!1,Director.getInstance().repleaceScene(new GameScene)},e.gotoTest=function(){var t=new ResLoading;Director.getInstance().pushScene(t);var i=(new CallBackFunc).handler(e.onTest,this,[]);t.load(["test"],i)},e.onTest=function(){Director.getInstance().repleaceScene(new Test)},e.gotoChat=function(){Director.getInstance().repleaceScene(new ChatScene)},e}();__reflect(SceneMgr.prototype,"SceneMgr");var SoundsMgr=function(){function e(){}return e.playBtn=function(){this.playMusic("button_mp3")},e.clickCell=function(){this.playMusic("dianji_mp3")},e.removeCell=function(e){var t=["efx_combine_1_mp3","efx_combine_2_mp3","efx_combine_3_mp3","efx_combine_4_mp3","efx_combine_5_mp3","efx_combine_6_mp3","efx_combine_7_mp3"];e>=6&&(e=6),this.playMusic(t[e])},e.win=function(){this.playMusic("win_mp3")},e.lose=function(){this.playMusic("lose_mp3")},e.playMusic=function(e){var t=RES.getRes(e.toString());t&&(this.bgSoundChannel=t.play(0,1))},e.bgSoundChannel=null,e}();__reflect(SoundsMgr.prototype,"SoundsMgr");var GameAddOneCfg=function(){function e(){}return e.colorArray=[4286945,65535,65280,8322816,16776960,16750866,16736512,8399402,10494192],e.Grid={row:6,column:6},e}();__reflect(GameAddOneCfg.prototype,"GameAddOneCfg");var GameAddOneEvent=function(e){function t(t,i,n){return void 0===i&&(i=!1),void 0===n&&(n=!1),e.call(this,t,i,n)||this}return __extends(t,e),t.GameOver="GameOver",t.CellAddOne="CellAddOne",t.CellRemove="CellRemove",t.CellAddPos="CellAddPos",t.CellMoveOver="CellMoveOver",t}(egret.Event);__reflect(GameAddOneEvent.prototype,"GameAddOneEvent");var GameAddOneScene=function(e){function t(){var t=e.call(this)||this;return GridMgr.init(),t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddStage,t),t}return __extends(t,e),t.prototype.onAddStage=function(){this.createStage(),this.createAllCell()},t.prototype.createStage=function(){var e=new egret.Sprite;e.graphics.beginFill(8947848,1),e.graphics.drawRect(0,0,Display.winSize.width,Display.winSize.height),e.graphics.endFill(),this.addChild(e)},t.prototype.createAllCell=function(){this.cellPanel=new egret.Sprite,this.cellPanel.graphics.beginFill(1002080,1);var e=6*Grid.width+25,t=6*Grid.height+25;this.cellPanel.graphics.drawRect(0,0,e,t),this.cellPanel.graphics.endFill(),this.addChild(this.cellPanel),this.cellPanel.width=e,this.cellPanel.height=t,this.cellPanel.anchorOffsetX=e/2,this.cellPanel.anchorOffsetY=t,this.cellPanel.x=Display.winSize.cx,this.cellPanel.y=Display.winSize.height-10;for(var i=RES.getRes("cellCfg_json"),n=0;6>n;n++)for(var r=0;6>r;r++){var o=this.createCell(n,r),a=parseInt(i[1][n][r]);o.setNum(a),this.cellPanel.addChild(o)}},t.prototype.createCell=function(e,t){var i=new Grid(e,t),n=GridMgr.getDifferentNum(e,t);return i.setNum(n),GridMgr.addCell(i),i.x=GridMgr.getPositionX(t),i.y=GridMgr.getPositionY(e),i.addEventListener(GameAddOneEvent.CellAddOne,this.onCellAddOne,this),i.addEventListener(GameAddOneEvent.CellRemove,this.onCellRemove,this),i.addEventListener(GameAddOneEvent.CellAddPos,this.onCellAddPos,this),i.addEventListener(GameAddOneEvent.CellMoveOver,this.onCellMoveOver,this),i},t.prototype.onCellMoveOver=function(e){if(GridMgr.isMoveOver()){GridMgr.allCellTurnToNormal();var t=GridMgr.getCleanList();if(t)for(var i in t){var n=t[i];n.removeSelf()}}},t.prototype.fillAllCell=function(){for(var e=GameAddOneCfg.Grid.row-1;e>=0;e--)for(var t=0;t<GameAddOneCfg.Grid.column;t++){var i=GridMgr._cellArray[e][t];if(null==i){var n=this.createCell(e,t);n.fill(),this.cellPanel.addChild(n)}}},t.prototype.onCellAddPos=function(e){egret.log("addPos");var t=e.currentTarget,i=GridMgr.getSameCellByCell(t);for(var n in i){var r=i[n];r.removeSelf()}},t.prototype.onCellAddOne=function(e){var t=e.currentTarget,i=GridMgr.getSameCellByCell(t);if(i.push(t),i.length>=3)for(var n in i){var r=i[n];r.highlightShow()}else GridMgr.dropAllCell(),GridMgr.allCellTurnToNormal(),this.fillAllCell()},t.prototype.onCellRemove=function(e){GridMgr.isMoveOver()&&(console.log("remove"),GridMgr.dropAllCell(),GridMgr.allCellTurnToNormal(),this.fillAllCell())},t}(egret.DisplayObjectContainer);__reflect(GameAddOneScene.prototype,"GameAddOneScene");var Grid=function(e){function t(i,n){var r=e.call(this)||this;return r.checkFlag=!1,r.moveFlag=!1,r.isHeightLight=!1,r.num=0,r.row=0,r.column=0,r.row=i,r.column=n,r.width=t.width,r.height=t.height,r.anchorOffsetX=r.width/2,r.anchorOffsetY=r.height/2,r.init(),r.touchEnabled=!0,r.addEventListener(egret.TouchEvent.TOUCH_END,r.onClick,r),r}return __extends(t,e),t.prototype.init=function(){this._bg=new egret.Sprite,this.addChild(this._bg),this._numLabel=new eui.Label,this._numLabel.touchEnabled=!1,this.addChild(this._numLabel)},t.prototype.resetColor=function(){var e=GameAddOneCfg.colorArray[this.num-1];this._bg.graphics.clear(),this._bg.graphics.beginFill(e,1),this._bg.graphics.drawRoundRect(0,0,t.width,t.height,20,20),this._bg.graphics.endFill()},t.prototype.setNum=function(e){this.num=e,this._numLabel.text=e.toString(),this._numLabel.anchorOffsetX=this._numLabel.width/2,this._numLabel.anchorOffsetY=this._numLabel.height/2,this._numLabel.x=this.width/2,this._numLabel.y=this.height/2,this.resetColor()},t.prototype.onClick=function(){if(this.isHeightLight){var e=new GameAddOneEvent(GameAddOneEvent.CellAddPos);this.dispatchEvent(e)}else{this.num++;var t=egret.Tween.get(this);t.to({scaleX:.7,scaleY:1.1},100).to({scaleX:1,scaleY:.8},80).to({scaleX:1,scaleY:1},10).call(function(){this.setNum(this.num);var e=new GameAddOneEvent(GameAddOneEvent.CellAddOne);this.dispatchEvent(e)},this)}},t.prototype.removeSelf=function(){if(0==this.moveFlag){this.moveFlag=!0,GridMgr.RemoveCell(this);var e=egret.Tween.get(this);e.to({scaleX:.6,scaleY:.6},300,egret.Ease.backOut).call(function(){this.moveFlag=!1;var e=new GameAddOneEvent(GameAddOneEvent.CellRemove);this.dispatchEvent(e),this.parent.removeChild(this)},this)}},t.prototype.highlightShow=function(){this.isHeightLight=!0;var e=GameAddOneCfg.colorArray[this.num-1];this._bg.graphics.clear(),this._bg.graphics.beginFill(e,1),this._bg.graphics.drawCircle(t.width/2,t.height/2,t.width/2),this._bg.graphics.endFill()},t.prototype.normalShow=function(){this.isHeightLight=!1,this.resetColor()},t.prototype.moveToPos=function(e,t){if(0==this.moveFlag){this.moveFlag=!0,this.row=e,this.column=t;var i=GridMgr.getPositionX(this.column),n=GridMgr.getPositionY(this.row),r=egret.Tween.get(this);r.to({x:i,y:n},400,egret.Ease.bounceOut).call(function(){this.moveFlag=!1;var e=new GameAddOneEvent(GameAddOneEvent.CellMoveOver);this.dispatchEvent(e)},this)}},t.prototype.fill=function(){if(0==this.moveFlag){this.moveFlag=!0;var e=GridMgr.getPositionX(this.column),i=-t.height;this.x=e,this.y=i;var n=GridMgr.getPositionX(this.column),r=GridMgr.getPositionY(this.row),o=egret.Tween.get(this);o.to({x:n,y:r},400,egret.Ease.bounceOut).call(function(){this.moveFlag=!1;var e=new GameAddOneEvent(GameAddOneEvent.CellMoveOver);this.dispatchEvent(e)},this)}},t.width=60,t.height=60,t}(egret.Sprite);__reflect(Grid.prototype,"Grid");var GridMgr=function(){function e(){}return e.init=function(){for(var t=0;6>t;t++){e._cellArray.push([]);for(var i=0;6>i;i++)e._cellArray[t][i]=null}},e.addCell=function(t){var i=t.row,n=t.column;e._cellArray[i][n]=t},e.getPositionX=function(e){var t=e*(Grid.width+5)+Grid.width/2;return t},e.getDifferentNum=function(e,t){var i=[1,2,3,4,5,6,7,8,9,10],n=[];if(t-1>=0){var r=this._cellArray[e][t-1];if(r){var o=r.num;n.push(o)}}if(t+1<GameAddOneCfg.Grid.column){var a=this._cellArray[e][t+1];if(a){var s=a.num;n.push(s)}}if(e-1>=0){var l=this._cellArray[e-1][t];if(l){var h=l.num;n.push(h)}}if(e+1<GameAddOneCfg.Grid.row){var c=this._cellArray[e+1][t];if(c){var u=c.num;n.push(u)}}for(var d in n){var p=n[d];Util.removeByElements(i,p)}var g=i.length,f=Math.floor(Math.random()*g);return i[f]},e.getPositionY=function(e){var t=e*(Grid.height+5)+Grid.height/2;return t},e.getCleanCell=function(){for(var t=0;t<GameAddOneCfg.Grid.row;t++)for(var i=0;i<GameAddOneCfg.Grid.column;i++){var n=e._cellArray[t][i];if(n&&0==n.checkFlag){var r=[];if(r.push(n),this.getSameCell(n,r),r.length>=2)for(var o in r){var a=r[o];a.removeSelf()}}}this.setAllCellCheckFlag(!1)},e.getCleanList=function(){for(var e=GameAddOneCfg.Grid.row-1;e>=0;e--)for(var t=0;t<GameAddOneCfg.Grid.column;t++){var i=this._cellArray[e][t],n=this.getSameCellByCell(i);if(n.push(i),n.length>=3)return n}return null},e.getSameCellByCell=function(e){var t=[];return this.getSameCell(e,t),t.length>=2?(this.setAllCellCheckFlag(!1),t):(this.setAllCellCheckFlag(!1),[])},e.RemoveCell=function(e){var t=e.row,i=e.column;this._cellArray[t][i]=null},e.isMoveOver=function(){for(var t=0;t<GameAddOneCfg.Grid.row;t++)for(var i=0;i<GameAddOneCfg.Grid.column;i++){var n=e._cellArray[t][i];if(n&&1==n.moveFlag)return!1}return!0},e.allCellTurnToNormal=function(){for(var t=0;t<GameAddOneCfg.Grid.row;t++)for(var i=0;i<GameAddOneCfg.Grid.column;i++){var n=e._cellArray[t][i];n&&n.normalShow()}},e.setAllCellCheckFlag=function(t){for(var i=0;i<GameAddOneCfg.Grid.row;i++)for(var n=0;n<GameAddOneCfg.Grid.column;n++){var r=e._cellArray[i][n];r&&(r.checkFlag=t)}},e.getSameCell=function(e,t){e.checkFlag=!0;var i=e.row,n=e.column;if(n-1>=0){var r=this._cellArray[i][n-1];r&&r.num==e.num&&0==r.checkFlag&&(t.push(r),this.getSameCell(r,t))}if(n+1<GameAddOneCfg.Grid.column){var o=this._cellArray[i][n+1];o&&o.num==e.num&&0==o.checkFlag&&(t.push(o),this.getSameCell(o,t))}if(i-1>=0){var a=this._cellArray[i-1][n];a&&a.num==e.num&&0==a.checkFlag&&(t.push(a),this.getSameCell(a,t))}if(i+1<GameAddOneCfg.Grid.row){var s=this._cellArray[i+1][n];s&&s.num==e.num&&0==s.checkFlag&&(t.push(s),this.getSameCell(s,t))}},e.dropAllCell=function(){for(var t=GameAddOneCfg.Grid.row-1;t>=0;t--)for(var i=0;i<GameAddOneCfg.Grid.column;i++){var n=e._cellArray[t][i];if(n){var r=this.getFillPos(n.row,n.column);(n.row!=r.row||n.column!=r.column)&&(this.swapCell(n,r.row,r.column),n.moveToPos(r.row,r.column))}}},e.swapCell=function(e,t,i){this._cellArray[t][i]=e,this._cellArray[e.row][e.column]=null,e.row=t,e.column=i},e.getFillPos=function(e,t){for(var i={row:e,column:t},n=e+1;n<GameAddOneCfg.Grid.row;){var r=this._cellArray[n][t];if(null!=r)break;i.row++,n++}return i},e._cellArray=[],e}();__reflect(GridMgr.prototype,"GridMgr");var tiled;!function(e){var t=function(t){function i(i,n,r,o){var a=t.call(this)||this;a._tmxRenderer=null,a._data=r,a._renderWidth=i,a._renderHeight=n,a._rows=+r.attributes.width,a._cols=+r.attributes.height,a._tilewidth=+r.attributes.tilewidth,a._tileheight=+r.attributes.tileheight,a._nextobjectid=+r.attributes.nextobjectid,a._version=+r.attributes.version,a._orientation=r.attributes.orientation,a._renderorder=r.attributes.renderorder,a._baseURL=o,a._baseURL=decodeURIComponent(a._baseURL);var s=a._baseURL.lastIndexOf("/");return a._baseURL=a._baseURL.slice(0,s+1),a._orientation===e.TMXConstants.ORIENTATION_ISOMETRIC?(a.width=(a._rows+a._cols)*(a._tilewidth/2),a.height=(a._rows+a._cols)*(a._tileheight/2)):(a.width=a._rows*a._tilewidth,a.height=a._cols*a._tileheight),a._hexsidelength=+r.attributes.hexsidelength,a._staggeraxis=r.attributes.staggeraxis||void 0,a._staggerindex=r.attributes.staggerindex||void 0,a._backgroundcolor=r.attributes.backgroundcolor,a._z=0,a._layers=[],null!==a._tmxRenderer&&a._tmxRenderer.canRender(a)||(a._tmxRenderer=a.getNewDefaultRenderer(a)),a._initialized=!1,a}return __extends(i,t),Object.defineProperty(i.prototype,"nextobjectid",{get:function(){return this._nextobjectid},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"tilewidth",{get:function(){return this._tilewidth},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"tileheight",{get:function(){return this._tileheight},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rows",{get:function(){return this._rows},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"cols",{get:function(){return this._cols},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"baseURL",{get:function(){return this._baseURL},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"renderwidth",{get:function(){return this._renderWidth},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"renderheight",{get:function(){return this._renderHeight},enumerable:!0,configurable:!0}),i.prototype.render=function(){for(var e=this.getLayers(),t=0;t<e.length;t++)this.addChild(e[t]);this.addEventListener(egret.Event.ENTER_FRAME,this.onStartRendering,this)},i.prototype.getLayers=function(){return this.readMapObjects(this._data),this._layers},i.prototype.getObjects=function(){this.readMapObjects(this._data);for(var t=[],i=0;i<this._layers.length;i++)this._layers[i]instanceof e.TMXObjectGroup&&t.push(this._layers[i]);return t},i.prototype.parseProperties=function(t){var i,n=t.children;if(n){i=[];for(var r=0;r<n.length;r++){var o=n[r],a=new e.TMXProperty;a.name=o.attributes.name,a.value=o.attributes.value,i[r]=a}}return i},i.prototype.showHideBackground=function(t){this._showHideBackground=t;for(var i=0;i<this._layers.length;i++){var n=this._layers[i];if(n instanceof e.TMXColorLayer)return void(n.visible=t)}},i.prototype.destory=function(){this._tilesets=void 0,this._layers=[],this._initialized=!1,this.removeEventListener(egret.Event.ENTER_FRAME,this.onStartRendering,this),e.TMXTileset.removeAllTextures(),this.parent&&this.parent.removeChild(this)},i.prototype.readMapObjects=function(t){if(this._initialized!==!0){var i=this._z,n=this;this._tilesets||(this._tilesets=new e.TMXTilesetGroup(this)),this._backgroundcolor&&this._showHideBackground&&this._layers.push(new e.TMXColorLayer(this,this._backgroundcolor,i++));var r=this._data.children;if(r)for(var o=0;o<r.length;o++){var a=r[o];switch(a.localName){case e.TMXConstants.TILE_SET:this._tilesets.add(new e.TMXTileset(this,a));break;case e.TMXConstants.LAYER:this._layers.push(this.parseLayer(a,i++));break;case e.TMXConstants.OBJECT_GROUP:this._layers.push(this.parseObjectGroup(a,i++));break;case e.TMXConstants.PROPERTIES:this._properties=this.parseProperties(a);break;case e.TMXConstants.IMAGE_LAYER:this._layers.push(this.parseImageLayer(a,i++))}}for(var s=0,o=0;o<this._tilesets.length;o++){var l=this._tilesets.getTilesetByIndex(o);if(l.image){var h=function(t){var i=t.currentTarget;i.removeEventListener(e.TMXImageLoadEvent.IMAGE_COMPLETE,h,this),s++,s==this._tilesets.imagelength&&n.dispatchEvent(new e.TMXImageLoadEvent(e.TMXImageLoadEvent.ALL_IMAGE_COMPLETE))};l.image.addEventListener(e.TMXImageLoadEvent.IMAGE_COMPLETE,h,this)}}this._initialized=!0}},i.prototype.onStartRendering=function(t){for(var i=this.getLayers(),n=0;n<i.length;n++){var r=i[n];r instanceof e.TMXLayer&&r.render()}for(var o=this.getObjects(),n=0;n<o.length;n++){o[n]}},i.prototype.getNewDefaultRenderer=function(t){switch(t._orientation){case"orthogonal":return new e.TMXOrthogonalRenderer(t.rows,t.cols,t.tilewidth,t.tileheight);case"isometric":return new e.TMXIsometricRenderer(t.rows,t.cols,t.tilewidth,t.tileheight);case"hexagonal":return new e.TMXHexagonalRenderer(t.rows,t.cols,t.tilewidth,t.tileheight,t._hexsidelength,t._staggeraxis,t._staggerindex);default:throw new Error(t._orientation+" type TMX Tile Map not supported!")}},i.prototype.parseLayer=function(t,i){var n=new e.TMXLayer(this,this._tilewidth,this._tileheight,this._orientation,this._tilesets,i,t);this._tmxRenderer.canRender(n)?n.setRenderer(this.getNewDefaultRenderer(this)):n.setRenderer(this._tmxRenderer);var r=this,o=function(t){r.removeEventListener(e.TMXImageLoadEvent.ALL_IMAGE_COMPLETE,o,this),this.draw(new egret.Rectangle(0,0,r._renderWidth,r._renderHeight))};return this.addEventListener(e.TMXImageLoadEvent.ALL_IMAGE_COMPLETE,o,n),n},i.prototype.parseObjectGroup=function(t,i){var n=new e.TMXObjectGroup(t,this._orientation,this._tilesets,i),r=this,o=function(t){r.removeEventListener(e.TMXImageLoadEvent.ALL_IMAGE_COMPLETE,o,this),this.draw(new egret.Rectangle(0,0,r._renderWidth,r._renderHeight))};return this.addEventListener(e.TMXImageLoadEvent.ALL_IMAGE_COMPLETE,o,n),n},i.prototype.parseTileset=function(t){return new e.TMXTileset(t,this)},i.prototype.parseImageLayer=function(t,i){var n=this,r=new e.TMXImageLayer(this,t,i),o=function(e){this.draw(new egret.Rectangle(0,0,n._renderWidth,n._renderHeight))};return r.addEventListener(e.TMXImageLoadEvent.IMAGE_COMPLETE,o,r),r},i}(egret.Sprite);e.TMXTilemap=t,__reflect(t.prototype,"tiled.TMXTilemap")}(tiled||(tiled={}));var tiled;!function(e){var t=function(){function t(t,i,n,r,o){if(this.tileX=n,this.tileY=r,this._currentFrame=0,o){this._tilemap=t,this._tileset=i,this._data=o,this._animations=[],this._currentFrame=0;var a=o.children;if(a)for(var s=0;s<a.length;s++){var l=a[s],h=new e.TMXAnimationFrame(t,i,n,r,l);this._animations[s]=h}}}return t.prototype.render=function(){this._currentFrame++,this._currentFrame=this._currentFrame%this._animations.length},Object.defineProperty(t.prototype,"currentAnimationFrame",{get:function(){return this._animations[this._currentFrame]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"animations",{get:function(){return this._animations},enumerable:!0,configurable:!0}),t}();e.TMXAnimation=t,__reflect(t.prototype,"tiled.TMXAnimation")}(tiled||(tiled={}));var tiled;!function(e){var t=function(){function t(t,i,n,r,o){this._tiledid=+o.attributes.tileid,this._duration=+o.attributes.duration,this._tile=new e.TMXTile(n,r,this._tiledid+i.firstgid,t,i)}return Object.defineProperty(t.prototype,"tile",{get:function(){return this._tile},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tiledId",{get:function(){return this._tiledid},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"duration",{get:function(){return this._duration},enumerable:!0,configurable:!0}),t}();e.TMXAnimationFrame=t,__reflect(t.prototype,"tiled.TMXAnimationFrame")}(tiled||(tiled={}));var tiled;!function(e){var t=function(){function e(){}return e.TMX_FLIP_H=2147483648,e.TMX_FLIP_V=1073741824,e.TMX_FLIP_AD=536870912,e.TMX_CLEAR_BIT_MASK=536870911,e.LAYER="layer",e.OBJECT_GROUP="objectgroup",e.PROPERTIES="properties",e.DATA="data",e.OBJECT="object",e.IMAGE="image",e.IMAGE_LAYER="imagelayer",e.TILE_SET="tileset",e.TILE="tile",e.TILE_OFFSET="tileoffset",e.ANIMATION="animation",e.DEFAULT_COLOR=10526884,e.DRAWORDER_INDEX="index",e.POLYGON="polygon",e.POLYLINE="polyline",e.ELLIPSE="ellipse",e.TILE_OBJECT_GROUP="tileobjectgroup",e.ORIENTATION_ORTHOGONAL="orthogonal",e.ORIENTATION_ISOMETRIC="isometric",e.ORIENTATION_STAGGERED="staggered",e.ORIENTATION_HEXAGONAL="hexagonal",e}();e.TMXConstants=t,__reflect(t.prototype,"tiled.TMXConstants")}(tiled||(tiled={}));var tiled;!function(e){var t=function(e){function t(t,i,n,r){void 0===i&&(i=null),void 0===n&&(n=!0),void 0===r&&(r=!1);var o=e.call(this,t,n,r)||this;return o.texture=i,o}return __extends(t,e),t.IMAGE_COMPLETE="complete",t.ALL_IMAGE_COMPLETE="allComplete",t}(egret.Event);e.TMXImageLoadEvent=t,__reflect(t.prototype,"tiled.TMXImageLoadEvent")}(tiled||(tiled={}));var tiled;!function(e){var t=function(t){function i(i,n,r){var o=t.call(this)||this;return o._tilemap=i,o._color=n,o._z=r,o.graphics.beginFill(e.TMXUtils.color16ToUnit(o._color),1),o.graphics.drawRect(0,0,i.renderwidth,i.renderheight),o.graphics.endFill(),o}return __extends(i,t),i}(egret.Sprite);e.TMXColorLayer=t,__reflect(t.prototype,"tiled.TMXColorLayer")}(tiled||(tiled={}));var tiled;!function(e){var t=function(t){function i(i,n,r){var o=t.call(this,i,n,r)||this;o._name=n.attributes.name,o.x=+n.attributes.x,o.y=+n.attributes.y,o._z=r,o._opacity="undefined"!=typeof+n.attributes.opacity?+n.attributes.opacity:1,o.visible="undefined"!=typeof+n.attributes.visible?Boolean(+n.attributes.visible):!0;var a=n.children;if(a)for(var s=0;s<a.length;s++){var l=n.children[s];switch(l.localName){case e.TMXConstants.IMAGE:o._source=l.attributes.source,o._transColor=l.attributes.trans,o.loadImage(o.tilemap.baseURL+o._source);break;case e.TMXConstants.PROPERTIES:o._properties=o._tilemap.parseProperties(l);break;default:throw new Error("TMXTileMap decode ImageLayer is Error："+l.localName)}}return o}return __extends(i,t),Object.defineProperty(i.prototype,"bitmap",{get:function(){return this._bitmap},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"texture",{get:function(){return this._texture},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"alpha",{get:function(){return this._opacity},enumerable:!0,configurable:!0}),i.prototype.loadImage=function(t){null!=t&&""!=t&&RES.getResByUrl(t,function(t){t&&(this._sourcebitmap.texture=t,this._texture=t,this.dispatchEvent(new e.TMXImageLoadEvent(e.TMXImageLoadEvent.IMAGE_COMPLETE,t)))},this,RES.ResourceItem.TYPE_IMAGE)},i.prototype.draw=function(e){var t=new egret.RenderTexture,i=new egret.Rectangle(this.x,this.y,this._sourcebitmap.width,this._sourcebitmap.height);e=i.intersection(e),e.right=Math.ceil(this.tilemap.width/this.tilemap.tilewidth)*this.tilemap.tilewidth,e.bottom=Math.ceil(this.tilemap.height/this.tilemap.tileheight)*this.tilemap.tileheight,t.drawToTexture(this._sourcebitmap,e),this._bitmap=new egret.Bitmap,this._bitmap.texture=t,this._bitmap.alpha=this._opacity,this._bitmap.visible=this.visible,this.addChild(this._bitmap)},i}(e.TMXLayerBase);e.TMXImageLayer=t,__reflect(t.prototype,"tiled.TMXImageLayer")}(tiled||(tiled={}));var tiled;!function(e){var t=function(t){function i(i,n,r,o,a,s,l){var h=t.call(this,i,l,s)||this;h._staticContainer=new egret.Sprite,h.addChild(h._staticContainer),setTimeout(function(e){e._staticContainer.cacheAsBitmap=!0},2e3,h),h._animationContainer=new egret.Sprite,h.addChild(h._animationContainer),h._tilemap=i,h._tilewidth=n,h._tileheight=r,h._orientation=o,h._tilesets=a,h.tileset=h._tilesets?h._tilesets.getTilesetByIndex(0):null,h.maxTileSize={width:0,height:0};for(var c=0;c<h._tilesets.length;c++){var u=h._tilesets.getTilesetByIndex(c);h.maxTileSize.width=Math.max(h.maxTileSize.width,u.tilewidth),h.maxTileSize.height=Math.max(h.maxTileSize.height,u.tileheight)}h._name=l.attributes.name,h._cols=+l.attributes.width,h._rows=+l.attributes.height,h._opacity="undefined"!=typeof l.attributes.opacity?parseFloat(l.attributes.opacity):1,h.visible="undefined"!=typeof l.attributes.visible?Boolean(+l.attributes.visible):!0,h._hexsidelength=+l.attributes.hexsidelength,h._staggeraxis=l.attributes.staggeraxis,h._staggerindex=+l.attributes.staggerindex,"isometric"===h._orientation?(h.width=(h._cols+h._rows)*(h._tilewidth/2),h.height=(h._cols+h._rows)*(h._tileheight/2)):(h.width=h._cols*h._tilewidth,h.height=h._rows*h._tileheight),h.initArray(h._cols,h._rows);var d=l.children;if(d)for(var c=0;c<d.length;c++){var p=d[c];switch(p.localName){case e.TMXConstants.DATA:h.parseLayerData(e.TMXUtils.decode(p,p.attributes.encoding,p.attributes.compression));break;case e.TMXConstants.PROPERTIES:h._properties=h.tilemap.parseProperties(p);break;default:throw new Error("TMXTileMap decode Layer is Error："+p.localName)}}return h.alpha=h._opacity,h.visible=h.visible,h}return __extends(i,t),Object.defineProperty(i.prototype,"staticContainer",{get:function(){return this._staticContainer},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"animationContainer",{get:function(){return this._animationContainer
},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"tilewidth",{get:function(){return this._tilewidth},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"tileheight",{get:function(){return this._tileheight},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"orientation",{get:function(){return this._orientation},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rows",{get:function(){return this._rows},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"cols",{get:function(){return this._cols},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"hexsidelength",{get:function(){return this._hexsidelength},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"staggeraxis",{get:function(){return this._staggeraxis},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"staggerindex",{get:function(){return this.staggerindex},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"opacity",{get:function(){return this._opacity},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"properties",{get:function(){return this._properties},enumerable:!0,configurable:!0}),i.prototype.setRenderer=function(e){this.renderer=e},i.prototype.getTileId=function(e,t){var i=this.getTile(e,t);return i?i.gid:0},i.prototype.getTile=function(t,i){return this.renderer instanceof e.TMXOrthogonalRenderer?this.layerData[~~this.renderer.pixelToTileX(t)][~~this.renderer.pixelToTileY(i)]:this.renderer instanceof e.TMXIsometricRenderer?this.layerData[~~this.renderer.pixelToTileX(t,i)][~~this.renderer.pixelToTileY(i,t)]:this.layerData[~~this.renderer.pixelToTileX(t,i)][~~this.renderer.pixelToTileY(i,t)]},i.prototype.setTile=function(t,i,n){if(this.tileset.contains(n)||(this.tileset=this._tilesets.getTilesetByGid(n)),this.tileset){var r=this.layerData[t][i]=new e.TMXTile(t,i,n,this.tilemap,this.tileset);return r}return null},i.prototype.clearTile=function(e,t){this.layerData[e][t]=null},i.prototype.draw=function(e){this.renderer.drawTileLayer(this,e)},i.prototype.render=function(){this.renderer.render(this._animationContainer)},i.prototype.initArray=function(e,t){this.layerData=[];for(var i=0;e>i;i++){this.layerData[i]=[];for(var n=0;t>n;n++)this.layerData[i][n]=null}},i.prototype.parseLayerData=function(e){if(e)for(var t=0,i=0;i<this.rows;i++)for(var n=0;n<this.cols;n++){var r=e[t];0!==r&&this.setTile(n,i,r),t++}},i}(e.TMXLayerBase);e.TMXLayer=t,__reflect(t.prototype,"tiled.TMXLayer")}(tiled||(tiled={}));var AssetAdapter=function(){function e(){}return e.prototype.getAsset=function(e,t,i){function n(n){t.call(i,n,e)}if(RES.hasRes(e)){var r=RES.getRes(e);r?n(r):RES.getResAsync(e,n,this)}else RES.getResByUrl(e,n,this,RES.ResourceItem.TYPE_IMAGE)},e}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var tiled;!function(e){var t=function(t){function i(e,i){var n=t.call(this)||this;return n._width=+e.attributes.width,n._height=+e.attributes.height,n._source=e.attributes.source,n._trans="undefined"!=typeof e.attributes.trans?e.attributes.trans:"000000",n._bitmap=new egret.Bitmap,n._source=i+n._source,n.loadImage(n._source),n}return __extends(i,t),Object.defineProperty(i.prototype,"texture",{get:function(){return this._texture},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"bitmap",{get:function(){return this._bitmap},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"source",{get:function(){return this._source},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),i.prototype.loadImage=function(t){null!=t&&""!=t&&RES.getResByUrl(t,function(t){t&&(this._bitmap.texture=t,this._texture=t,this._width=t.textureWidth,this._height=t.textureHeight,this.dispatchEvent(new e.TMXImageLoadEvent(e.TMXImageLoadEvent.IMAGE_COMPLETE,t)))},this,RES.ResourceItem.TYPE_IMAGE)},i}(egret.EventDispatcher);e.TMXImage=t,__reflect(t.prototype,"tiled.TMXImage")}(tiled||(tiled={}));var tiled;!function(e){var t=function(t){function i(i,n,r,o,a){var s=t.call(this)||this;if(s._points=void 0,s._name=i.attributes.name,s.x=+i.attributes.x,s.y=+i.attributes.y,s._z=+o,s.width=+i.attributes.width||0,s.height=+i.attributes.height||0,s._gid=+i.attributes.gid||null,s._type=i.attributes.type,s.rotation=+i.attributes.rotation||0,s._id=+i.attributes.id||void 0,s._orientation=n,s._shapes=void 0,s._color=a,s._isEllipse=!1,s._isPolygon=!1,s._isPolyLine=!1,s.visible="undefined"!=typeof i.attributes.visible?Boolean(+i.attributes.visible):!0,"number"==typeof s._gid)s._isImage=!0,s.setTile(r);else{s._points=[];var l=i.children;if(l)for(var h=0;h<l.length;h++){var c=l[h];switch(c.localName){case e.TMXConstants.ELLIPSE:s._isEllipse=!0,s._isImage=!1,s._ellipse=s.parseEllipse(c);break;case e.TMXConstants.POLYGON:s._isPolygon=!0,s._isImage=!1,s._points=s.parsePolygonOrPolyline(c.attributes.points);break;case e.TMXConstants.POLYLINE:s._isPolyLine=!0,s._isImage=!1,s._points=s.parsePolygonOrPolyline(c.attributes.points);break;case e.TMXConstants.PROPERTIES:r.tilemap&&(s._properties=r.tilemap.parseProperties(c))}}}s._shapes||(s._shapes=s.parseTMXShapes());for(var h=0;h<s._shapes.length;h++){var u=s._shapes[h];s.addChild(u)}return s}return __extends(i,t),Object.defineProperty(i.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"gid",{get:function(){return this._gid},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"z",{get:function(){return this._z},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isEllipse",{get:function(){return this._isEllipse},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isPolygon",{get:function(){return this._isPolygon},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isPolyLine",{get:function(){return this._isPolyLine},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isImage",{get:function(){return this._isImage},enumerable:!0,configurable:!0}),i.prototype.parsePolygonOrPolyline=function(e){var t=[],i=e.split(" ");if(i)for(var n=0;n<i.length;n++){var r=i[n].split(",");t[n]=[+r[0],+r[1]]}return t},i.prototype.parseEllipse=function(e){var t=+e.attributes.width||32,i=+e.attributes.height||32;return[t,i]},i.prototype.parseTMXShapes=function(){var t=[];if(this._isEllipse){var i=new e.Ellipse(0,0,this.width,this.height);i.draw(this._color),t.push(i)}else if(this._isPolygon){var n=new e.Polygon(0,0,this._points);n.draw(this._color),t.push(n)}else if(this._isPolyLine){var r=new e.PolyLine(0,0,this._points);r.draw(this._color),t.push(r)}else if(!this._gid){var n=new e.Polygon(0,0,[[0,0],[this.width,0],[this.width,this.height],[0,this.height]]);n.draw(this._color),t.push(n)}if("isometric"===this._orientation)for(var o=0;o<t.length;o++){var a=t[o];a.rotation=45,a.scaleX=Math.SQRT1_2,a.scaleY=Math.SQRT1_2}return t},i.prototype.setTile=function(t){var i=t.getTilesetByGid(this._gid);if(i){var n=i.image;n&&(this._tile=new e.TMXTile(0,0,this.gid,i.tilemap,i),i.drawTile(this,i.tileoffset.x,i.tileoffset.y-i.tileheight,this._tile))}},i}(egret.Sprite);e.TMXObject=t,__reflect(t.prototype,"tiled.TMXObject")}(tiled||(tiled={}));var tiled;!function(e){var t=function(t){function i(i,n,r,o){var a=t.call(this)||this;return a._name=i.attributes.name,a._opacity="undefined"!=typeof i.attributes.opacity?+i.attributes.opacity:1,a._draworder=i.attributes.draworder,a._color=i.attributes.color?e.TMXUtils.color16ToUnit(i.attributes.color):e.TMXConstants.DEFAULT_COLOR,a._orientaion=n,a._tilesets=r,a._z=o,a.visible="undefined"!=typeof i.attributes.visible?Boolean(+i.attributes.visible):!0,a._objects=[],a._objectHash={},a._childrens=i.children,a}return __extends(i,t),Object.defineProperty(i.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),i.prototype.draw=function(){if(this._childrens)for(var t=0;t<this._childrens.length;t++){var i=new e.TMXObject(this._childrens[t],this._orientaion,this._tilesets,this._z,this._color);i.alpha=this._opacity,this._objects[t]=i,this.addChild(i),this._objectHash[i.id]=i}},i.prototype.render=function(){},i.prototype.destory=function(){this._objects=null},i.prototype.getObjectById=function(e){return this._objectHash[e]},i.prototype.removeObjectById=function(e){var t=this.getObjectById(e);t&&t.parent&&t.parent.removeChild(t)},i.prototype.showHideObjectById=function(e,t){var i=this.getObjectById(e);i&&(i.visible=!0)},i.prototype.getObjectCount=function(){return this._objects.length},i.prototype.getObjectByIndex=function(e){return this._objects[e]},i.prototype.removeObjectByIndex=function(e){var t=this.getObjectByIndex(e);t&&t.parent&&t.parent.removeChild(t)},i}(egret.Sprite);e.TMXObjectGroup=t,__reflect(t.prototype,"tiled.TMXObjectGroup")}(tiled||(tiled={}));var tiled;!function(e){var t=function(){function e(){this.gid=0}return e}();e.TMXProperty=t,__reflect(t.prototype,"tiled.TMXProperty")}(tiled||(tiled={}));var tiled;!function(e){var t=function(t){function i(e,i,n,r,o,a,s){var l=t.call(this,e,i,n,r)||this;return l._hexsidelength=o,l._staggeraxis=a,l._staggerindex=s,l._sidelengthx=0,l._sidelengthy=0,"x"===a?l._sidelengthx=o:l._sidelengthy=o,l._sideoffsetx=(l.tilewidth-l._sidelengthx)/2,l._sideoffsety=(l.tileheight-l._sidelengthy)/2,l._columnwidth=l._sideoffsetx+l._sidelengthx,l._rowheight=l._sideoffsety+l._sidelengthy,l._centers=[new egret.Point,new egret.Point,new egret.Point,new egret.Point],l}return __extends(i,t),i.prototype.canRender=function(i){return i.orientation===e.TMXConstants.ORIENTATION_HEXAGONAL&&t.prototype.canRender.call(this,i)},i.prototype.pixelToTileCoords=function(e,t){"x"===this._staggeraxis?e-="old"===this._staggerindex?this._sidelengthx:this.tilewidth:t-="old"===this._staggerindex?this._sideoffsety:this.tileheight;var i=new egret.Point(Math.floor(e/(this.tilewidth+this._sidelengthx)),Math.floor(t/(this.tileheight+this._sidelengthy))),n=new egret.Point(e-i.x*(this.tilewidth+this._sidelengthx),t-i.y*(this.tilewidth+this._sidelengthy));"x"===this._staggeraxis?(i.x=2*i.x,"even"===this._staggerindex&&++i.x):(i.y=2*i.y,"even"===this._staggerindex&&++i.y);var r,o,a,s;"x"===this._staggeraxis?(r=this._sidelengthx/2,a=r+this._columnwidth,s=this.tileheight/2,this._centers[0].setTo(r,s),this._centers[1].setTo(a,s-this._rowheight),this._centers[2].setTo(a,s+this._rowheight),this._centers[3].setTo(a+this._columnwidth,s)):(o=this._sidelengthy/2,a=this.tilewidth/2,s=o+this._rowheight,this._centers[0].setTo(a,o),this._centers[1].setTo(a-this._columnwidth,s),this._centers[2].setTo(a+this._columnwidth,s),this._centers[3].setTo(a,s+this._rowheight));for(var l,h=0,c=Number.MAX_VALUE,u=0;4>u;++u)l=Math.pow(this._centers[u].x-n.x,2)+Math.pow(this._centers[u].y-n.y,2),c>l&&(c=l,h=u);var d=[{x:0,y:0},{x:1,y:-1},{x:1,y:0},{x:2,y:0}],p=[{x:0,y:0},{x:-1,y:1},{x:0,y:1},{x:0,y:2}],g="x"===this._staggeraxis?d:p;return new egret.Point(i.x+g[h].x,i.y+g[h].y)},i.prototype.pixelToTileX=function(e,t){var i=this.pixelToTileCoords(e,t);return i.x},i.prototype.pixelToTileY=function(e,t){var i=this.pixelToTileCoords(t,e);return i.y},i.prototype.tileToPixelCoords=function(e,t){var i,n;return"x"===this._staggeraxis?(i=e*this._columnwidth,"odd"===this._staggerindex?(n=t*(this.tileheight+this._sidelengthy),n+=this._rowheight*(1&e)):(n=t*(this.tileheight+this._sidelengthy),n+=this._rowheight*(1-(1&e)))):(n=t*this._rowheight,"odd"===this._staggerindex?(i=e*(this.tilewidth+this._sidelengthx),i+=this._columnwidth*(1&t)):(i=e*(this.tilewidth+this._sidelengthx),i+=this._columnwidth*(1-(1&t)))),new egret.Point(i,n)},i.prototype.drawTile=function(e,t,i,n){var r=this.tileToPixelCoords(t,i),o=n.tileset;o.drawTile(e,o.tileoffset.x+r.x,o.tileoffset.y+r.y+(this.tileheight-o.tileheight),n)},i.prototype.drawTileLayer=function(e,t){var i=e.staticContainer,n=this.pixelToTileCoords(Math.floor(t.x),Math.floor(t.y)),r=this.pixelToTileCoords(Math.floor(t.x+t.width+this.tilewidth),Math.floor(t.y+t.height+this.tileheight));n.x=n.x<0?0:n.x,n.y=n.y<0?0:n.y,r.x=r.x>this.rows?this.rows:r.x,r.y=r.y>this.cols?this.cols:r.y;for(var o=n.y;o<r.y;o++)for(var a=n.x;a<r.x;a++){var s=e.layerData[a][o];s&&(s.animation?this.animationTiles.push({tmxTile:s,pos:[a,o]}):this.drawTile(i,a,o,s))}},i}(e.TMXRenderer);e.TMXHexagonalRenderer=t,__reflect(t.prototype,"tiled.TMXHexagonalRenderer")}(tiled||(tiled={}));var tiled;!function(e){var t=function(t){function i(e,i,n,r){var o=t.call(this,e,i,n,r)||this;return o._hTilewidth=o.tilewidth/2,o._hTileheight=o.tileheight/2,o._originX=o.rows*o._hTilewidth,o}return __extends(i,t),i.prototype.canRender=function(i){return i.orientation===e.TMXConstants.ORIENTATION_ISOMETRIC&&t.prototype.canRender.call(this,i)},i.prototype.pixelToTileCoords=function(e,t){Math.floor(this.pixelToTileX(e,t)),Math.floor(this.pixelToTileY(t,e));return new egret.Point(this.pixelToTileX(e,t),this.pixelToTileY(t,e))},i.prototype.pixelToTileX=function(e,t){t/this.tileheight+(e-this._originX)/this.tilewidth;return t/this.tileheight+(e-this._originX)/this.tilewidth},i.prototype.pixelToTileY=function(e,t){e/this.tileheight-(t-this._originX)/this.tilewidth;return e/this.tileheight-(t-this._originX)/this.tilewidth},i.prototype.tileToPixelCoords=function(e,t){return new egret.Point((e-t)*this._hTilewidth+this._originX,(e+t)*this._hTileheight)},i.prototype.drawTile=function(e,t,i,n){var r=n.tileset;r.drawTile(e,r.tileoffset.x+t,r.tileoffset.y+i-r.tileheight,n)},i.prototype.drawTileLayer=function(e,t){var i=e.staticContainer,n=e.tileset,r=n.tileoffset,o=this.pixelToTileCoords(t.x-n.tilewidth,t.y-n.tileheight);o=new egret.Point(Math.floor(o.x),Math.floor(o.y));var a=this.pixelToTileCoords(t.x+t.width+n.tilewidth,t.y+t.height+n.tileheight);a=new egret.Point(Math.ceil(a.x),Math.ceil(a.y));var s=this.tileToPixelCoords(a.x,a.y),l=this.tileToPixelCoords(o.x,o.y);l.x-=this._hTilewidth,l.y+=this.tileheight;var h=l.y-t.y>this._hTileheight,c=t.x-l.x<this._hTilewidth;h&&(c?(o.x--,l.x-=this._hTilewidth):(o.y--,l.x+=this._hTilewidth),l.y-=this._hTileheight);for(var u=Boolean(+h^+c),d=o.clone(),p=l.y;p-this.tileheight<s.y;p+=this._hTileheight){d.setTo(o.x,o.y);for(var g=l.x;g<s.x;g+=this.tilewidth){if(d.x>=0&&d.y>=0&&d.x<this.rows&&d.y<this.cols){var f=e.layerData[d.x][d.y];f&&(n=f.tileset,r=n.tileoffset,f&&(f.animation?this.animationTiles.push({tmxTile:f,pos:[r.x+g,r.y+p]}):this.drawTile(i,g,p,f)))}d.x++,d.y--}u?(o.y++,l.x-=this._hTilewidth,u=!1):(o.x++,l.x+=this._hTilewidth,u=!0)}},i}(e.TMXRenderer);e.TMXIsometricRenderer=t,__reflect(t.prototype,"tiled.TMXIsometricRenderer")}(tiled||(tiled={}));var tiled;!function(e){var t=function(t){function i(e,i,n,r){return t.call(this,e,i,n,r)||this}return __extends(i,t),i.prototype.canRender=function(i){return i.orientation===e.TMXConstants.ORIENTATION_ORTHOGONAL&&t.prototype.canRender.call(this,i)},i.prototype.pixelToTileCoords=function(e,t){return new egret.Point(this.pixelToTileX(e),this.pixelToTileY(t))},i.prototype.pixelToTileX=function(e){return Math.floor(e/this.tilewidth)},i.prototype.pixelToTileY=function(e){return Math.floor(e/this.tileheight)},i.prototype.tileToPixelCoords=function(e,t){return new egret.Point(e*this.tilewidth,t*this.tileheight)},i.prototype.drawTile=function(e,t,i,n){var r=n.tileset;r.drawTile(e,r.tileoffset.x+t*this.tilewidth,r.tileoffset.y+(i+1)*this.tileheight-r.tileheight,n)},i.prototype.drawTileLayer=function(e,t){var i=e.staticContainer,n=this.pixelToTileCoords(Math.floor(Math.max(t.x-(e.maxTileSize.width-e.tilewidth),0)),Math.floor(Math.max(t.y-(e.maxTileSize.height-e.tileheight),0))),r=this.pixelToTileCoords(Math.ceil(t.x+t.width+this.tilewidth),Math.ceil(t.y+t.height+this.tileheight));r.x=r.x>this.rows?this.rows:r.x,r.y=r.y>this.cols?this.cols:r.y;for(var o=n.y;o<r.y;o++)for(var a=n.x;a<r.x;a++){var s=e.layerData[a][o];s&&(s.animation?this.animationTiles.push({tmxTile:s,pos:[a,o]}):this.drawTile(i,a,o,s))}},i}(e.TMXRenderer);e.TMXOrthogonalRenderer=t,__reflect(t.prototype,"tiled.TMXOrthogonalRenderer")}(tiled||(tiled={}));var Main=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(e){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},egret.ImageLoader.crossOrigin="anonymous";var t=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",t),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(e){console.log(e)}),ScreenMgr.instance.designWidth=640,ScreenMgr.instance.designHeight=1136},t.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return[4,this.loadResource()];case 1:return t.sent(),this.createGameScene(),[4,platform.getUserInfo()];case 2:return e=t.sent(),console.log(e),[2]}})})},t.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,4,,5]),e=new LoadingUI,this.stage.addChild(e),[4,RES.loadConfig("default.res.json",GameData.sourceUrl)];case 1:return i.sent(),[4,this.loadTheme()];case 2:return i.sent(),[4,RES.loadGroup("preload",0,e)];case 3:return i.sent(),this.stage.removeChild(e),[3,5];case 4:return t=i.sent(),console.error(t),[3,5];case 5:return[2]}})})},t.prototype.loadTheme=function(){var e=this;return new Promise(function(t,i){var n=new eui.Theme("resource/default.thm.json",e.stage);n.addEventListener(eui.UIEvent.COMPLETE,function(){t()},e)})},t.prototype.createGameScene=function(){Director.getInstance().initWithMain(this),PlayerData.initData(),SceneMgr.gotoLogoin()},t.prototype.createBitmapByName=function(e){var t=new egret.Bitmap,i=RES.getRes(e);return t.texture=i,t},t.prototype.onButtonClick=function(e){var t=new eui.Panel;t.title="Title",t.horizontalCenter=0,t.verticalCenter=0,this.addChild(t)},t}(eui.UILayer);__reflect(Main.prototype,"Main");var tiled;!function(e){var t=function(e){function t(t,i,n,r){var o=e.call(this)||this;return o.x=t,o.y=i,o.width=n,o.height=r,o}return __extends(t,e),t.prototype.draw=function(e){this.graphics.clear(),this.graphics.lineStyle(2,e),this.graphics.beginFill(e,.2),this.graphics.drawEllipse(0,0,this.width,this.height),this.graphics.endFill()},t}(egret.Sprite);e.Ellipse=t,__reflect(t.prototype,"tiled.Ellipse")}(tiled||(tiled={}));var tiled;!function(e){var t=function(e){function t(t,i,n){var r=e.call(this)||this;return r.points=n,r.x=t,r.y=i,r}return __extends(t,e),t.prototype.draw=function(e){if(this.graphics.clear(),this.graphics.lineStyle(2,e),this.graphics.beginFill(e,.2),this.points)for(var t=0;t<this.points.length;t++){var i=this.points[t];0==t?this.graphics.moveTo(i[0],i[1]):this.graphics.lineTo(i[0],i[1])}this.graphics.endFill()},t}(egret.Sprite);e.Polygon=t,__reflect(t.prototype,"tiled.Polygon")}(tiled||(tiled={}));var tiled;!function(e){var t=function(e){function t(t,i,n){var r=e.call(this)||this;return r.points=n,r.x=t,r.y=i,r}return __extends(t,e),t.prototype.draw=function(e){if(this.graphics.clear(),this.graphics.lineStyle(2,e),this.graphics.beginFill(e,.2),this.points)for(var t=0;t<this.points.length;t++){var i=this.points[t];0==t?this.graphics.moveTo(i[0],i[1]):this.graphics.lineTo(i[0],i[1])}this.graphics.endFill()},t}(egret.Sprite);e.PolyLine=t,__reflect(t.prototype,"tiled.PolyLine")}(tiled||(tiled={}));var tiled;!function(e){var t=function(t){function i(i,n,r,o,a){var s=t.call(this)||this;if(s._tileset=a,s._tileX=i,s._tileY=n,s._tilemap=o,s._gid=r,s._flippedX=0!==(s._gid&e.TMXConstants.TMX_FLIP_H),s._flippedY=0!==(s._gid&e.TMXConstants.TMX_FLIP_V),s._flippedAD=s._flippedX&&s._flippedY,s._flipped=s._flippedX||s._flippedY||s._flippedAD,s._gid&=e.TMXConstants.TMX_CLEAR_BIT_MASK,s._tileData=a.getSpecialTileDataByTileId(s._gid),s._tileData){var l=s._tileData.children;if(l)for(var h=0;h<l.length;h++){var c=l[h];switch(c.localName){case e.TMXConstants.PROPERTIES:s._properties=o.parseProperties(c);break;case e.TMXConstants.OBJECT_GROUP:break;case e.TMXConstants.IMAGE:s._image=new e.TMXImage(c,s.tilemap.baseURL);break;case e.TMXConstants.ANIMATION:s._animation=new e.TMXAnimation(o,a,i,n,c)}}}return s}return __extends(i,t),Object.defineProperty(i.prototype,"gid",{get:function(){return this._gid},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"tileX",{get:function(){return this._tileX},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"tileY",{get:function(){return this._tileY},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"tileset",{get:function(){return this._tileset},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"image",{get:function(){return this._image},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"tilemap",{get:function(){return this._tilemap},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"flippedX",{get:function(){return this._flippedX},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"flippedY",{get:function(){return this._flippedY},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"flippedAD",{get:function(){return this._flippedAD},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"flipped",{get:function(){return this._flipped},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"animation",{get:function(){return this._animation},enumerable:!0,configurable:!0}),i}(egret.Sprite);e.TMXTile=t,__reflect(t.prototype,"tiled.TMXTile")}(tiled||(tiled={}));var tiled;!function(e){var t=function(){function t(t,i){this.getFileExtension=function(e){return e.substring(e.lastIndexOf(".")+1,e.length)},this._tileDatas=[],e.TMXTileset._cacheRenderTextures={},this._firstgid=+i.attributes.firstgid,this._lastgid=this._firstgid,this._tilemap=t;var n=i.attributes.source;if(n&&"tsx"===this.getFileExtension(n))throw new Error("tmx not support tsx file load!!!");this._transformMatrix=new egret.Matrix,this._name=i.attributes.name,this._tilewidth=+i.attributes.tilewidth,this._tileheight=+i.attributes.tileheight,this._spacing=+i.attributes.spacing||0,this._margin=+i.attributes.margin||0,this._tileoffset=new egret.Point,this._hTileCount=0,this._vTileCount=0;var r=i.children;if(r)for(var o=0;o<r.length;o++){var a=r[o];switch(a.localName){case e.TMXConstants.IMAGE:this._image=new e.TMXImage(a,this.tilemap.baseURL),this._imagesource=this._image.source;break;case e.TMXConstants.TILE_OFFSET:this._tileoffset=new egret.Point(+a.attributes.x,+a.attributes.y);break;case e.TMXConstants.TILE:var s=+a.attributes.id+this._firstgid;null==this._tileDatas[s]&&(this._tileDatas[s]=a);break;case e.TMXConstants.PROPERTIES:this._properties=t.parseProperties(a)}}this._image&&(this._hTileCount=~~(this._image.width/(this._tilewidth+this._spacing)),this._vTileCount=~~(this._image.height/(this._tileheight+this._margin)),this._lastgid=this._firstgid+(this._hTileCount*this._vTileCount-1||0))}return Object.defineProperty(t.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"firstgid",{get:function(){return this._firstgid},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lastgid",{get:function(){return this._lastgid},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tilewidth",{get:function(){return this._tilewidth},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tileheight",{get:function(){return this._tileheight},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"spacing",{get:function(){return this._spacing},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"margin",{get:function(){return this._margin},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tileoffset",{get:function(){return this._tileoffset},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"horizontalTileCount",{get:function(){return this._hTileCount},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"verticalTileCount",{get:function(){return this._vTileCount},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tilemap",{get:function(){return this._tilemap},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"properties",{get:function(){return this._properties},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"image",{get:function(){return this._image},enumerable:!0,configurable:!0}),t.prototype.getSpecialTileDataByTileId=function(e){return this._tileDatas[e]},t.prototype.getProperties=function(){return this._properties},t.prototype.getPropertyByIndex=function(e){return this._properties&&e<this._properties.length?this._properties[e]:null},t.prototype.contains=function(e){return e>=this._firstgid&&e<=this._lastgid},t.prototype.drawTile=function(t,i,n,r){var o,a=r.gid-this.firstgid,s=this.firstgid+"_"+a;if(s&&(null==e.TMXTileset._cacheRenderTextures[s]?this.image&&(o=new egret.RenderTexture,o.drawToTexture(this.image.bitmap,new egret.Rectangle(a%this.horizontalTileCount*(this.tilewidth+this._spacing)+this._spacing,Math.floor(a/this.horizontalTileCount)*(this.tileheight+this._margin)+this._margin,this.tilewidth,this.tileheight)),e.TMXTileset._cacheRenderTextures[s]=o):o=e.TMXTileset._cacheRenderTextures[s],o)){var l=!1,h=!1;t instanceof e.TMXObject&&(h=!0,l=t.isImage),this._transformMatrix.identity();var c=h?t.width/o.textureWidth:1,u=h?t.height/o.textureHeight:1;r.flippedAD?(this._transformMatrix.scale(-1*c,-1*u),this._transformMatrix.translate(i+t.width*c,n+t.height*u)):r.flippedY?(this._transformMatrix.scale(1*c,-1*u),this._transformMatrix.translate(i,n+t.height*u)):r.flippedX?(this._transformMatrix.scale(-1*c,1*u),this._transformMatrix.translate(i+t.width*c,n)):(this._transformMatrix.scale(c,u),this._transformMatrix.translate(i,n+(h?o.textureHeight-t.height:0))),null==r.bitmap&&(r.bitmap=new egret.Bitmap),r.bitmap.texture=o,r.bitmap.matrix=this._transformMatrix,t.addChild(r.bitmap)}},t.removeAllTextures=function(){this._cacheRenderTextures={}},t}();e.TMXTileset=t,__reflect(t.prototype,"tiled.TMXTileset")}(tiled||(tiled={}));var tiled;!function(e){var t=function(){function t(e){this._tilesets=[],this._length=0,this._imagelength=0,this._tilemap=e}return Object.defineProperty(t.prototype,"length",{get:function(){return this._length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imagelength",{get:function(){return this._imagelength},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tilemap",{get:function(){return this._tilemap},enumerable:!0,configurable:!0}),t.prototype.add=function(e){this._tilesets.push(e),this._length++,e.image&&this._imagelength++},t.prototype.getTilesetByIndex=function(e){return this._tilesets[e]},t.prototype.getTilesetByGid=function(t){if(0===t)return null;var i=-1;t&=e.TMXConstants.TMX_CLEAR_BIT_MASK;for(var n=0,r=this._tilesets.length;r>n;n++){var o=this._tilesets[n];if(o.contains(t))return o;o.firstgid===o.lastgid&&t>=o.firstgid&&(i=n)}if(-1!==i)return this._tilesets[i];throw new Error("no matching tileset found for gid "+t)},t}();e.TMXTilesetGroup=t,__reflect(t.prototype,"tiled.TMXTilesetGroup")}(tiled||(tiled={}));var tiled;!function(e){var t=function(){function e(){}return Object.defineProperty(e,"nativeBase64",{get:function(){return"function"==typeof window.atob},enumerable:!0,configurable:!0}),e.decode=function(e){if(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,""),this.nativeBase64)return window.atob(e);for(var t,i,n,r,o,a,s,l=[],h=0;h<e.length;)r=this._keyStr.indexOf(e.charAt(h++)),o=this._keyStr.indexOf(e.charAt(h++)),a=this._keyStr.indexOf(e.charAt(h++)),s=this._keyStr.indexOf(e.charAt(h++)),t=r<<2|o>>4,i=(15&o)<<4|a>>2,n=(3&a)<<6|s,l.push(String.fromCharCode(t)),64!==a&&l.push(String.fromCharCode(i)),64!==s&&l.push(String.fromCharCode(n));return l=l.join("")},e.encode=function(e){if(e=e.replace(/\r\n/g,"\n"),!this.nativeBase64){for(var t,i,n,r,o,a,s,l=[],h=0;h<e.length;)t=e.charCodeAt(h++),i=e.charCodeAt(h++),n=e.charCodeAt(h++),r=t>>2,o=(3&t)<<4|i>>4,a=(15&i)<<2|n>>6,s=63&n,isNaN(i)?a=s=64:isNaN(n)&&(s=64),l.push(this._keyStr.charAt(r)),l.push(this._keyStr.charAt(o)),l.push(this._keyStr.charAt(a)),l.push(this._keyStr.charAt(s));return l=l.join("")}window.btoa(e)},e.decodeBase64AsArray=function(t,i){i=i||1;var n,r,o,a=e.decode(t),s=new Uint32Array(a.length/i);for(n=0,o=a.length/i;o>n;n++)for(s[n]=0,r=i-1;r>=0;--r)s[n]+=a.charCodeAt(n*i+r)<<(r<<3);return s},e.decompress=function(e,t,i){throw new Error("GZIP/ZLIB compressed TMX Tile Map not supported!")},e.decodeCSV=function(e){for(var t=e.replace("\n","").trim().split(","),i=[],n=0;n<t.length;n++)i.push(+t[n]);return i},e._keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",e}();e.Base64=t,__reflect(t.prototype,"tiled.Base64")}(tiled||(tiled={}));var tiled;!function(e){var t=function(){function t(){}return t.create=function(t,i,n,r,o,a){void 0===o&&(o=null),void 0===a&&(a=null),RES.getResByUrl(n,function(s){try{var s=egret.XML.parse(s)}catch(l){throw new Error("tmx文件格式不正确！")}var h=new e.TMXTilemap(t,i,s,n);h.render(),r.addChild(h),o&&o.apply(a)},this,RES.ResourceItem.TYPE_XML)},t.decode=function(t,i,n){n=n||"none",i=i||"none";var r=t.children[0].text;switch(i){case"base64":var o=e.Base64.decodeBase64AsArray(r,4);return"none"===n?o:e.Base64.decompress(r,o,n);case"csv":return e.Base64.decodeCSV(r);case"none":for(var a=[],s=0;s<t.children.length;s++)a[s]=+t.children[s].attributes.gid;return a;default:throw new Error("未定义的编码:"+i)}},t.color16ToUnit=function(e){var t="0x"+e.slice(1);return parseInt(t,16)},t}();e.TMXUtils=t,__reflect(t.prototype,"tiled.TMXUtils")}(tiled||(tiled={}));var ChatItem=function(e){function t(t){var i=e.call(this)||this;return i.skinName="ChatItemSkin",i.wordLabel.text=t.toString(),i.addEventListener(egret.Event.ADDED_TO_STAGE,i.addStage,i),i}return __extends(t,e),t.prototype.addStage=function(){},t}(eui.Component);__reflect(ChatItem.prototype,"ChatItem");var ChatScene=function(e){function t(){var t=e.call(this)||this;return t.skinName="ChatSkin",t.addEventListener(egret.Event.ADDED_TO_STAGE,t.addStage,t),t}return __extends(t,e),t.prototype.addStage=function(){this.sendBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSend,this)},t.prototype.onSend=function(){var e=this.inputWord.text;if(e){var t={word:e};Net.getInstance().sendHttpRequest(NetMsg.arr.chat.send,t)}},t}(eui.Component);__reflect(ChatScene.prototype,"ChatScene");var LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.createView(),t}return __extends(t,e),t.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},t.prototype.onProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var CellMgr=function(){function e(){}return e.cleanCellArray=function(){this.cellArray=[];for(var e=0;e<GameCfg.row;e++){this.cellArray.push([]);for(var t=0;t<GameCfg.column;t++)this.cellArray[e].push(null)}},e.genDropCellId=function(e,t){var i=[1,2,3,4,5],n=Math.random()*i.length,r=Math.floor(n);return i[r]},e.genInitCellId=function(e,t){var i=RES.getRes("gameCellCfg_json"),n=i[1],r=n[e][t];return r},e.removeAllCellAction=function(){for(var e in this.cellArray)for(var t in this.cellArray[e]){var i=this.cellArray[e][t];
i&&(egret.Tween.removeTweens(i),i.scaleX=i.scaleY=1)}},e.setAllCellCheckFlag=function(e){for(var t in this.cellArray)for(var i in this.cellArray[t]){var n=this.cellArray[t][i];n&&(n.checkFlag=e)}},e.getNowCleanListNum=function(){var e=[];for(var t in this.cellArray)for(var i in this.cellArray[t]){var n=this.cellArray[t][i];if(n&&0==n.checkFlag){var r=[n];this.getSameArrByCell(n,r),r.length>=GameCfg.baseCleanNum&&e.push(r)}}return this.setAllCellCheckFlag(!1),e},e.getSameArrByCell=function(e,t){var i=e.row,n=e.column,r=e.id;e.checkFlag=!0;var o=i,a=n-1;if(a>=0){var s=this.cellArray[o][a];s.id==r&&0==s.checkFlag&&(s.checkFlag=!0,this.getSameArrByCell(s,t),t.push(s))}var l=i,h=n+1;if(h<GameCfg.column){var c=this.cellArray[l][h];c.id==r&&0==c.checkFlag&&(c.checkFlag=!0,this.getSameArrByCell(c,t),t.push(c))}var u=i+1,d=n;if(u<GameCfg.row){var p=this.cellArray[u][d];p.id==r&&0==p.checkFlag&&(p.checkFlag=!0,this.getSameArrByCell(p,t),t.push(p))}var g=i-1,f=n;if(g>=0){var _=this.cellArray[g][f];_.id==r&&0==_.checkFlag&&(_.checkFlag=!0,this.getSameArrByCell(_,t),t.push(_))}},e.setCell=function(e,t,i){var n=e.row,r=e.column;this.cellArray[n][r]=null,e.row=t,e.column=i,this.cellArray[t][i]=e},e.cleanCell=function(e){var t=e.row,i=e.column;this.cellArray[t][i]=null},e.getCellPosX=function(e){var t=Cell.CellWidth/2,i=e*(Cell.CellWidth+GameCfg.columnSpace)+t;return i},e.getCellPosY=function(e){var t=Cell.CellHeight/2,i=e*(Cell.CellHeight+GameCfg.rowSpace)+t;return i},e.getTouchCell=function(e,t){for(var i in this.cellArray){var n=this.cellArray[i];for(var r in n){var o=n[r];if(o){var a=o.hitTestPoint(e,t);if(a)return o}}}return null},e.getCleanListID=function(){if(this.cleanList.length>0){var e=this.cleanList[0];return e.id}return 0},e.isInArround=function(e){var t=e.row,i=e.column,n=this.cleanList.length;if(n>0){var r=this.cleanList[n-1],o=r.row,a=r.column;if(!(o!=t+1&&o!=t-1&&o!=t||a!=i+1&&a!=i-1&&a!=i))return!0}return!1},e.getIsLastTwoInCleanList=function(e){var t=this.cleanList.length;if(t>=2){var i=t-2,n=this.cleanList[i];if(n==e)return!0}return!1},e.removeTopItemInCleanList=function(){var e=this.cleanList.length;if(e>0){var t=this.cleanList[e-1];return Util.removeByElements(this.cleanList,t),t}},e.removeTopLine=function(){var e=this.lineArray.length;if(e>0){var t=this.lineArray[e-1];Util.removeByElements(this.lineArray,t),t.parent&&t.parent.removeChild(t)}},e.isAllMove=function(){for(var e in this.cellArray){var t=this.cellArray[e];for(var i in t){var n=t[i];if(n&&1==n.moveFlag)return!0}}return!1},e.getEmptyCell=function(){for(var t=[],i=GameCfg.row-1;i>=0;i--)for(var n=0;n<GameCfg.column;n++){var r=e.cellArray[i][n];if(null==r){var o={row:i,column:n};t.push(o)}}return t},e.getDropRowAndColumn=function(e){var t=e.row,i=e.column,n={row:t,column:i};for(t++;t<GameCfg.row;){var r=this.cellArray[t][i];if(null!=r)break;n.row++,t++}return n},e.cellArray=[],e.cleanList=[],e.lineArray=[],e}();__reflect(CellMgr.prototype,"CellMgr");var CleanWithLineGameScene=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(egret.Event.ADDED_TO_STAGE,t.addStage,t),t}return __extends(t,e),t.prototype.addStage=function(){},t}(eui.Component);__reflect(CleanWithLineGameScene.prototype,"CleanWithLineGameScene");var GameCfg=function(){function e(){}return e.row=6,e.rowSpace=20,e.column=6,e.columnSpace=20,e.baseCleanNum=3,e}();__reflect(GameCfg.prototype,"GameCfg");var GameData=function(){function e(){}return e.reset=function(){this.enterLv=0,this.curStep=0,this.targetStep=0,this.curScore=0,this.targetScore=0,this.isOver=!1,this.isWin=!1},e.initLvData=function(t){this.reset();var i=CfgFileMgr.getLvCfgDatayId(t);e.targetScore=parseInt(i.score),e.targetStep=parseInt(i.step),e.curStep=e.targetStep,e.enterLv=t},e.enterLv=0,e.curStep=0,e.targetStep=0,e.curScore=0,e.targetScore=0,e.isOver=!1,e.isWin=!1,e.sourceUrl="https://h5.publish.1stgame.cn/mahjong_native_test/dongbei-jilin/resource/",e}();__reflect(GameData.prototype,"GameData");var GameState;!function(e){e[e.DealLogic=0]="DealLogic",e[e.Play=1]="Play"}(GameState||(GameState={}));var GameEvent=function(e){function t(t,i,n){return void 0===i&&(i=!1),void 0===n&&(n=!1),e.call(this,t,i,n)||this}return __extends(t,e),t.CleanOver="CleanOver",t.DropOver="DropOver",t}(egret.Event);__reflect(GameEvent.prototype,"GameEvent");var GameMissionProgress=function(e){function t(){var t=e.call(this)||this;return t.skinName="GameMissionProgressSkin",t.addEventListener(egret.Event.ADDED_TO_STAGE,t.addStage,t),t}return __extends(t,e),t.prototype.addStage=function(){},t}(eui.Component);__reflect(GameMissionProgress.prototype,"GameMissionProgress");var GameProgress=function(e){function t(){var t=e.call(this)||this;return t.skinName="GameProgressSkin",t}return __extends(t,e),t}(eui.Component);__reflect(GameProgress.prototype,"GameProgress");var GameScene=function(e){function t(){var t=e.call(this)||this;return t.state=GameState.Play,t.toBottom=250,t.map=null,t.cleanIndex=0,t.UILayer=new GameUI,t.addChild(t.UILayer),t.addEventListener(egret.Event.ADDED_TO_STAGE,t.addStage,t),t.onLoadMap(),t}return __extends(t,e),t.prototype.onLoadMap=function(){var e=this,t=GameData.sourceUrl+"cleanGame/tmx/map1.xml";RES.getResByUrl(t,function(i){console.error(i),e.map=new tiled.TMXTilemap(2e3,2e3,i,t),e.map.render(),e.map.addEventListener(tiled.TMXImageLoadEvent.ALL_IMAGE_COMPLETE,e.onLoaded,e),e.addChildAt(e.map,1)},this,RES.ResourceItem.TYPE_XML)},t.prototype.onLoaded=function(){if(this.map){this.map.visible=!0,this.map.scaleX=this.map.scaleY=8/9;var e=this.map.getLayers();for(var t in e){for(var i=e[t],n=i._name,r=0;r<i._rows;r++)for(var o=0;o<i._cols;o++){var a=i.getTile(r,o),s=i.getTileId(r,o);egret.log(n+":"+r+","+o+" => id:"+s),38==s&&(a.visible=!1)}var l=i.__class__;if("tiled.TMXLayer"==l){var h=i;h.getTile(0,0),h.getTileId(0,0)}else if("tiled.TMXObjectGroup"==l)for(var c=i,u=c.getObjectCount(),r=0;u>r;r++){var d=c.getObjectByIndex(r);if(d.isEllipse){var p=new EllipseShapData;p.pos=new egret.Point(d.x,d.y),p.ra=d.width,p.rb=d.height}else d.isImage||d.isPolygon||d.isPolyLine}}var g=this.map.getObjects();for(var t in g)var f=g[t],_=0}},t.prototype.addStage=function(){this.initStage(),this.initLinePanel(),this.initCellPanel(),this.initCell(),this.addChildAt(this.UILayer,1e3)},t.prototype.onBtn=function(){},t.prototype.initStage=function(){var e=new egret.Sprite;e.name="stageBg",e.graphics.beginFill(10066329,.8),e.graphics.drawRect(0,0,Display.winSize.width,Display.winSize.height),e.graphics.endFill(),e.visible=!1,this.addChild(e)},t.prototype.initCell=function(){CellMgr.cleanList=[],CellMgr.cleanCellArray();for(var e=0;e<GameCfg.row;e++)for(var t=0;t<GameCfg.column;t++){var i=CellMgr.genInitCellId(e,t),n=this.createCell(e,t,i);n.x=CellMgr.getCellPosX(t),n.y=CellMgr.getCellPosY(e)}},t.prototype.createCell=function(e,t,i){var n=new Cell(i);return n.row=e,n.column=t,n.addEventListener(GameEvent.CleanOver,this.cleanOneByeOne,this),n.addEventListener(GameEvent.DropOver,this.onDropOver,this),CellMgr.cellArray[e][t]=n,this.cellPanel.addChild(n),n},t.prototype.initLinePanel=function(){this.linePanel=new egret.Sprite,this.linePanel.name="linePanel",this.linePanel.width=GameCfg.column*Cell.CellWidth+(GameCfg.column-1)*GameCfg.columnSpace,this.linePanel.height=GameCfg.row*Cell.CellHeight+(GameCfg.row-1)*GameCfg.rowSpace,this.linePanel.anchorOffsetX=this.linePanel.width/2,this.linePanel.anchorOffsetY=this.linePanel.height,this.linePanel.x=Display.winSize.cx,this.linePanel.y=700,this.linePanel.graphics.beginFill(65280,0),this.linePanel.graphics.drawRect(0,0,this.linePanel.width,this.linePanel.height),this.linePanel.graphics.endFill(),this.addChild(this.linePanel)},t.prototype.initCellPanel=function(){this.cellPanel=new egret.Sprite,this.cellPanel.name="cellPanel",this.cellPanel.width=GameCfg.column*Cell.CellWidth+(GameCfg.column-1)*GameCfg.columnSpace,this.cellPanel.height=GameCfg.row*Cell.CellHeight+(GameCfg.row-1)*GameCfg.rowSpace,this.cellPanel.anchorOffsetX=this.cellPanel.width/2,this.cellPanel.anchorOffsetY=this.cellPanel.height,this.cellPanel.x=this.linePanel.x,this.cellPanel.y=this.linePanel.y;var e=new eui.Rect(this.cellPanel.width,this.cellPanel.height,255);e.alpha=0,this.cellPanel.addChild(e),this.cellPanel.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBegan,this),this.cellPanel.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMove,this),this.cellPanel.addEventListener(egret.TouchEvent.TOUCH_END,this.onEnd,this),this.cellPanel.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.outSide,this),this.addChild(this.cellPanel)},t.prototype.outSide=function(){this.onEnd()},t.prototype.onBegan=function(e){if(this.state==GameState.Play){this.deleteCleanList();var t=e.stageX,i=e.stageY,n=CellMgr.getTouchCell(t,i);if(n){n.setSelect(!0),this.pushCleanCell(n),egret.log("row: "+n.row+", column: "+n.column);var r=new egret.Point(n.x,n.y);this.createPointLine(r),this.pointLineBeganCell=n}}},t.prototype.createPointLine=function(e){this.pointLine&&this.pointLine.parent&&this.pointLine.parent.removeChild(this.pointLine),this.pointLine=new eui.Image,this.pointLine.texture=RES.getRes("line"),this.pointLine.width=0,this.pointLine.anchorOffsetX=0,this.pointLine.anchorOffsetY=this.pointLine.height/2,this.pointLine.x=e.x,this.pointLine.y=e.y,this.linePanel.addChild(this.pointLine)},t.prototype.updatePointLineEnd=function(e,t){if(this.pointLine&&this.pointLineBeganCell){var i=new egret.Point(this.pointLineBeganCell.x,this.pointLineBeganCell.y),n=this.linePanel.globalToLocal(e,t),r=egret.Point.distance(i,n);this.pointLine.width=r,this.pointLine.x=i.x,this.pointLine.y=i.y,this.pointLine.anchorOffsetX=0,this.pointLine.anchorOffsetY=this.pointLine.height/2;var o=this.getAngle(i,n);this.pointLine.rotation=o}},t.prototype.updatePointLineBegan=function(e,t){var i=CellMgr.cleanList.length;if(i>0){var n=CellMgr.cleanList[i-1];this.pointLineBeganCell=n,this.updatePointLineEnd(e,t)}},t.prototype.onMove=function(e){if(this.state==GameState.Play){var t=e.stageX,i=e.stageY;this.updatePointLineEnd(t,i);var n=CellMgr.getTouchCell(t,i);if(n)if(n.isSelected){var r=CellMgr.getIsLastTwoInCleanList(n);if(r){CellMgr.removeTopLine();var o=CellMgr.removeTopItemInCleanList();o.setSelect(!1),this.updatePointLineBegan(t,i)}}else{var a=CellMgr.getCleanListID(),s=CellMgr.isInArround(n);n.id==a&&s&&(n.setSelect(!0),this.pushCleanCell(n),this.updatePointLineBegan(t,i))}}},t.prototype.onEnd=function(){var e=CellMgr.cleanList.length;egret.log("可以消除的数量为: "+e),e>=GameCfg.baseCleanNum&&this.state==GameState.Play&&(this.state=GameState.DealLogic,this.cleanOneByeOne());for(var t in CellMgr.cleanList){var i=CellMgr.cleanList[t];i.setSelect(!1)}this.cleanAllLine()},t.prototype.cleanAllLine=function(){this.linePanel.removeChildren()},t.prototype.cleanOneByeOne=function(){var e=CellMgr.cleanList.length;if(0==e)this.deleteCleanList(),this.dropAndFillCell();else{var t=CellMgr.cleanList[0];this.createDirtyAndScore(t),t.clean(),SoundsMgr.removeCell(this.cleanIndex),this.cleanIndex++}},t.prototype.createDirtyAndScore=function(e){var t=["apple_png","blueberry_png","mangosteen_png","lemon_png","watermelon_png"],i=e.id,n=new eui.Image(t[i-1]),r=RES.getRes(t[i-1]);n.anchorOffsetX=r.textureWidth/2,n.anchorOffsetY=r.textureHeight/2,n.x=e.x,n.y=e.y,n.scaleX=n.scaleY=0;var o=360*Math.random();n.rotation=o,this.cellPanel.addChild(n);var a=egret.Tween.get(n);a.to({scaleX:1.2,scaleY:1.2},400,egret.Ease.bounceOut).wait(200).to({alpha:0},100).call(function(e){e&&e.parent&&e.parent.removeChild(e)},this,[n]);var s=10;this.UILayer.addScore(s);var l=new eui.Label;l.text=s.toString(),l.anchorOffsetX=l.width/2,l.anchorOffsetY=l.height/2,l.x=e.x,l.y=e.y,this.cellPanel.addChild(l);var h=egret.Tween.get(l);h.to({y:e.y-40},400).call(function(e){e&&e.parent&&e.parent.removeChild(e)},this,[l])},t.prototype.deleteCleanList=function(){CellMgr.cleanList=[],CellMgr.lineArray=[],this.cleanIndex=0},t.prototype.onDropOver=function(){var e=CellMgr.isAllMove();0==e&&(egret.log("Drop over"),this.onStepOver())},t.prototype.onStepOver=function(){this.state=GameState.Play,this.UILayer.reduceStep()},t.prototype.dropAndFillCell=function(){for(var e=GameCfg.row-1;e>=0;e--)for(var t=0;t<GameCfg.column;t++){var i=CellMgr.cellArray[e][t];if(null!=i){var n=CellMgr.getDropRowAndColumn(i),r=n.row,o=n.column;(i.row!=r||i.column!=o)&&i.drop(n.row,n.column)}}var a=CellMgr.getEmptyCell();for(var s in a){var l=a[s].row,h=a[s].column,c=CellMgr.genDropCellId(l,h),u=this.createCell(l,h,c);u.x=CellMgr.getCellPosX(h),u.y=-Cell.CellHeight/2,u.drop(l,h)}},t.prototype.pushCleanCell=function(e){CellMgr.cleanList.push(e);var t=CellMgr.cleanList.length;if(t>1){var i=CellMgr.cleanList[t-2];this.drawLine(i,e)}},t.prototype.drawLine=function(e,t){var i=RES.getRes("line"),n=new eui.Image;n.texture=i,n.anchorOffsetX=0,n.anchorOffsetY=i.textureHeight/2,this.linePanel.addChild(n),CellMgr.lineArray.push(n),n.x=e.x,n.y=e.y;var r=new egret.Point(e.x,e.y),o=new egret.Point(t.x,t.y),a=egret.Point.distance(r,o);n.width=a;var s=this.getAngle(r,o);n.rotation=s},t.prototype.getRotateAngle=function(e,t){var i=0,n=e.row,r=e.column,o=t.row,a=t.column;return o>n?r==a?i=90:r==a-1?i=45:r==a+1&&(i=135):n>o?r==a?i=-90:r==a-1?i=-45:r==a+1&&(i=-135):n==o&&(r==a-1?i=0:r==a+1&&(i=180)),i},t.prototype.getAngle=function(e,t){var i=(t.x-e.x,Math.abs(t.y-e.y)),n=egret.Point.distance(e,t),r=Math.round(Math.asin(i/n)/Math.PI*180);return e.x>t.x?e.y>t.y?r+=180:e.y<t.y?r=180-r:e.y==t.y&&(r=180):e.x<t.x?e.y>t.y?r=360-r:e.y<t.y?r=r:e.y==t.y&&(r=0):e.x==t.x&&(e.y>t.y?r=270:e.y<t.y&&(r=90)),r},t}(egret.DisplayObjectContainer);__reflect(GameScene.prototype,"GameScene");var GameUI=function(e){function t(){var t=e.call(this)||this;return t.star=0,t.skinName="GameUISkin",t.addEventListener(egret.Event.ADDED_TO_STAGE,t.addStage,t),t}return __extends(t,e),t.prototype.addStage=function(){this.width=ScreenMgr.instance.screenWidth,this.height=ScreenMgr.instance.screenHeight,this.init(),this.pauseBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPause,this)},t.prototype.init=function(){this.progress.value=0,this.gold.text="0",this.score.text="0",this.targetScore.text=GameData.targetScore.toString(),this.lv.text=GameData.enterLv.toString(),this.stepScore.text=GameData.targetStep.toString()},t.prototype.addScore=function(e){GameData.curScore+=e,this.score.text=GameData.curScore.toString();var t=GameData.targetScore,i=1.5*GameData.targetScore,n=2*GameData.targetScore;GameData.curScore<t?this.showStar(0):GameData.curScore>=t&&GameData.curScore<i?this.showStar(1):GameData.curScore>=i&&GameData.curScore<n?this.showStar(2):this.showStar(3);var r=GameData.curScore/n*100;this.progress.value=r},t.prototype.showStar=function(e){this.star=e,this.star1.source="game_rate1_off_png",this.star2.source="game_rate2_off_png",this.star3.source="game_rate3_off_png",1==e?this.star1.source="game_rate1_png":2==e?this.star2.source="game_rate2_png":3==e&&(this.star3.source="game_rate3_png")},t.prototype.reduceStep=function(){GameData.curStep--,this.stepScore.text=GameData.curStep.toString(),GameData.curStep<=0?(GameData.curStep=0,0==GameData.isOver&&(GameData.isOver=!0,GameData.isWin=!1,this.addDefeatLayer())):GameData.curScore>=GameData.targetScore&&0==GameData.isOver&&(GameData.isOver=!0,GameData.isWin=!0,this.addWinLayer())},t.prototype.addWinLayer=function(){Director.getInstance().pushScene(new WinUI(this.star))},t.prototype.addDefeatLayer=function(){Director.getInstance().pushScene(new LoseLayer)},t.prototype.onPause=function(){SoundsMgr.playBtn(),this.addChild(new PauseLayer)},t.prototype.onBtn=function(){return},t}(eui.Component);__reflect(GameUI.prototype,"GameUI");var GameEnterDlg=function(e){function t(t){var i=e.call(this)||this;return i.lv=t,i.skinName="GameEnterDlgSkin",i.addEventListener(egret.Event.ADDED_TO_STAGE,i.addStage,i),i.initData(),i}return __extends(t,e),t.prototype.addStage=function(){this.height=ScreenMgr.instance.screenHeight,this.width=ScreenMgr.instance.screenWidth,this.goImg.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onGo,this),this.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this)},t.prototype.onClose=function(){SoundsMgr.playBtn(),Director.getInstance().popScene()},t.prototype.initData=function(){this.lvLabel.text=this.lv.toString();var e=CfgFileMgr.getLvCfgDatayId(this.lv);if(e){var t="在"+e.step+"步之内达到"+e.score+"分";this.descLabel.text=t}},t.prototype.onGo=function(){SoundsMgr.playBtn(),GameData.initLvData(this.lv),SceneMgr.gotoGame()},t}(eui.Component);__reflect(GameEnterDlg.prototype,"GameEnterDlg");var LevelState;!function(e){e[e.NONE=0]="NONE",e[e.OPEN=1]="OPEN",e[e.CLOSE=2]="CLOSE"}(LevelState||(LevelState={}));var IndexButton=function(e){function t(){var t=e.call(this)||this;return t.state=LevelState.NONE,t.lvNumber=0,t.skinName="IndexButtonSkin",t.addEventListener(egret.Event.ADDED_TO_STAGE,t.addStage,t),t}return __extends(t,e),Object.defineProperty(t.prototype,"lv",{get:function(){return this.lvNumber},set:function(e){this.lvNumber=e,this.lvLabel.text=this.lvNumber.toString(),this.lvNumber<parseInt(PlayerData.data.fightLv)?this.setData(LevelState.OPEN):this.lvNumber==parseInt(PlayerData.data.fightLv)?(this.setData(LevelState.OPEN),this.showIcon()):this.setData(LevelState.CLOSE)},enumerable:!0,configurable:!0}),t.prototype.showIcon=function(){this.icon.visible=!0;var e=egret.Tween.get(this.icon,{loop:!0}),t=this.icon.y;e.to({y:t+20},1200,egret.Ease.backIn).to({y:t},500,egret.Ease.backOut)},t.prototype.setData=function(e){this.state=e,this.bg.source=this.getStateImage()},t.prototype.addStage=function(){},t.prototype.getStateImage=function(){return this.state==LevelState.CLOSE?"selet_g_lock_png":this.state==LevelState.OPEN?"selet_g_green_png":""},t}(eui.Component);__reflect(IndexButton.prototype,"IndexButton");var IndexGroup=function(e){function t(){var t=e.call(this)||this;return t.skinName="IndexGroupSkin",t.addEventListener(egret.Event.ADDED_TO_STAGE,t.addStage,t),t}return __extends(t,e),t.prototype.addStage=function(){var e=[this.btn1,this.btn2,this.btn3,this.btn4,this.btn5,this.btn6,this.btn7,this.btn8,this.btn9,this.btn10,this.btn11,this.btn12,this.btn13];for(var t in e){var i=e[t];i.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickBtn,this)}},t.prototype.clickBtn=function(e){SoundsMgr.playBtn();var t=e.currentTarget,i=t.lv;i<=parseInt(PlayerData.data.fightLv)?Director.getInstance().pushScene(new GameEnterDlg(i)):(new Tips).show("不能进入")},t}(eui.Component);__reflect(IndexGroup.prototype,"IndexGroup");var IndexScene=function(e){function t(){var t=e.call(this)||this;return t.prePoint=new egret.Point,t.indexUI=new IndexUI,t.addChild(t.indexUI),t.skinName="IndexSceneSkin",t.addEventListener(egret.Event.ADDED_TO_STAGE,t.addStage,t),t}return __extends(t,e),t.prototype.addStage=function(){this.width=ScreenMgr.instance.screenWidth,this.height=ScreenMgr.instance.screenHeight,this.initData(),this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBegan,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.onEnd,this),this.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMove,this)},t.prototype.initData=function(){this.list.addChild(new IndexGroup);var e={1:0,2:0,3:0,4:256,5:559,6:778,7:1e3,8:1284,9:1461,10:1617,11:1640,12:1640,13:1640};this.list.scrollV=e[PlayerData.data.fightLv.toString()]},t.prototype.onBegan=function(e){this.prePoint.x=e.stageX,this.prePoint.y=e.stageY},t.prototype.onMove=function(e){var t=e.stageX,i=e.stageY;this.prePoint.x=t,this.prePoint.y=i},t.prototype.onEnd=function(e){this.prePoint.x=e.stageX,this.prePoint.y=e.stageY},t}(eui.Component);__reflect(IndexScene.prototype,"IndexScene");var IndexUI=function(e){function t(){var t=e.call(this)||this;return t.skinName="IndexUISkin",t.addEventListener(egret.Event.ADDED_TO_STAGE,t.addStage,t),t}return __extends(t,e),t.prototype.addStage=function(){this.addGoldBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){(new Tips).show("功能暂未开放")},this),this.addHeartBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){(new Tips).show("功能暂未开放")},this)},t}(eui.Component);__reflect(IndexUI.prototype,"IndexUI");var ResLoading=function(e){function t(){var t=e.call(this)||this;return t.loadGroups=[],t.skinName="ResLoadingSkin",t.addEventListener(egret.Event.ADDED_TO_STAGE,t.addStage,t),t}return __extends(t,e),t.prototype.addStage=function(){this.addEventListener(egret.Event.ENTER_FRAME,this.update,this)},t.prototype.update=function(){this.circle.rotation+=3},t.prototype.load=function(e,t){egret.log("[ResLoading] 加载组:"+e),this.index=0,this.loadGroups=e,this.callback=t,RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.loadGroup(this.loadGroups[this.index])},t.prototype.isAllLoaded=function(){for(var e=!0,t=0;t<this.loadGroups.length;t++)e=e&&RES.isGroupLoaded(this.loadGroups[t]);return e},t.prototype.loadFinish=function(){RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),this.parent&&this.parent.removeChild(this),this.callback&&this.callback.exec()},t.prototype.onResourceLoadComplete=function(e){var t=this.isAllLoaded();egret.log("[LoadingCircle] group "+e.groupName+" loaded"),t?this.loadFinish():(this.index++,RES.loadGroup(this.loadGroups[this.index]))},t.prototype.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},t.prototype.onResourceProgress=function(e){this.setProgress(e.itemsLoaded,e.itemsTotal)},t.prototype.setProgress=function(e,t){this.textLabel.text=e+"/"+t},t}(eui.Component);__reflect(ResLoading.prototype,"ResLoading");var Logoin=function(e){function t(){var t=e.call(this)||this;return t.skinName="LogoinSkin",t.addEventListener(egret.Event.ADDED_TO_STAGE,t.addStage,t),t}return __extends(t,e),t.prototype.addStage=function(){this.width=ScreenMgr.instance.screenWidth,this.height=ScreenMgr.instance.screenHeight,console.error(this),this.initDB(),this.beganBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBegan,this);var e=egret.Tween.get(this.beganBtn,{loop:!0});e.to({scaleX:.8,scaleY:.8},1e3).to({scaleX:1,scaleY:1},1e3)},t.prototype.initDB=function(){var e=RES.getRes("tree_json"),t=RES.getRes("textureTree_json"),i=RES.getRes("textureTree_png"),n=new dragonBones.EgretFactory;n.addDragonBonesData(dragonBones.DataParser.parseDragonBonesData(e)),n.addTextureAtlas(new dragonBones.EgretTextureAtlas(i,t));var r=n.buildArmature("Armature");this.treeGroup.addChild(r.display),r.display.x=150,r.display.y=200,dragonBones.WorldClock.clock.add(r),r.animation.gotoAndPlay("run",-1,-1,0),egret.Ticker.getInstance().register(function(e){dragonBones.WorldClock.clock.advanceTime(.01)},this)},t.prototype.onBegan=function(){SoundsMgr.playBtn(),SceneMgr.gotoIndex()},t}(eui.Component);__reflect(Logoin.prototype,"Logoin");var LoseLayer=function(e){function t(){var t=e.call(this)||this;return t.skinName="LoseLayerSkin",t.addEventListener(egret.Event.ADDED_TO_STAGE,t.addStage,t),SoundsMgr.lose(),t}return __extends(t,e),t.prototype.addStage=function(){this.btnAgain.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onAgain,this),this.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this)},t.prototype.onAgain=function(){SceneMgr.rePlayLv()},t.prototype.onClose=function(){Director.getInstance().repleaceScene(new IndexScene)},t}(eui.Component);__reflect(LoseLayer.prototype,"LoseLayer");var PauseLayer=function(e){function t(){var t=e.call(this)||this;return t.skinName="PauseLayerSkin",t.addEventListener(egret.Event.ADDED_TO_STAGE,t.addStage,t),t}return __extends(t,e),t.prototype.addStage=function(){this.btn1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){SoundsMgr.playBtn(),this.parent&&this.parent.removeChild(this)},this),this.btn2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){SoundsMgr.playBtn(),SceneMgr.rePlayLv()},this),this.btn3.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){SoundsMgr.playBtn(),Director.getInstance().repleaceScene(new IndexScene)},this)},t}(eui.Component);__reflect(PauseLayer.prototype,"PauseLayer");var ClickButton=function(e){function t(){var t=e.call(this)||this;return t.skinName="ClickButtonSkin",t}return __extends(t,e),Object.defineProperty(t.prototype,"btnIcon",{get:function(){return this.icon.source},set:function(e){var t=RES.getRes(e);t&&(this.icon.source=t,this.icon.x=this.icon.y=0,this.width=t.textureWidth,this.height=t.textureHeight,this.anchorOffsetX=t.textureWidth/2,this.anchorOffsetY=t.textureHeight/2)},enumerable:!0,configurable:!0}),t.prototype.partAdded=function(t,i){e.prototype.partAdded.call(this,t,i)},t}(eui.Component);__reflect(ClickButton.prototype,"ClickButton");var DragonBonesTestLayer=function(e){function t(){var t=e.call(this)||this;return t.init(),t}return __extends(t,e),t.prototype.init=function(){var e=RES.getRes("Robot_json"),t=RES.getRes("texture_json"),i=RES.getRes("texture_png"),n=new dragonBones.EgretFactory;n.addDragonBonesData(dragonBones.DataParser.parseDragonBonesData(e)),n.addTextureAtlas(new dragonBones.EgretTextureAtlas(i,t));var r=n.buildArmature("Robot");this.addChild(r.display),r.display.x=200,r.display.y=300,r.display.scaleX=r.display.scaleY=.5,dragonBones.WorldClock.clock.add(r),r.animation.gotoAndPlay("run"),egret.Ticker.getInstance().register(function(e){dragonBones.WorldClock.clock.advanceTime(.01)},this)},t}(egret.DisplayObjectContainer);__reflect(DragonBonesTestLayer.prototype,"DragonBonesTestLayer");var LeanCloudTest=function(e){function t(){var t=e.call(this)||this;return t.skinName="LeanCloudTestSkin",t.addEventListener(egret.Event.ADDED_TO_STAGE,t.addStage,t),t}return __extends(t,e),t.prototype.addStage=function(){this.btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtn,this)},t.prototype.onBtn=function(){},t}(eui.Component);__reflect(LeanCloudTest.prototype,"LeanCloudTest");var WinUI=function(e){function t(t){var i=e.call(this)||this;return i.star=0,i.skinName="WinUISkin",i.star=t,i.addEventListener(egret.Event.ADDED_TO_STAGE,i.addStage,i),SoundsMgr.win(),i}return __extends(t,e),t.prototype.addStage=function(){this.width=ScreenMgr.instance.screenWidth,this.height=ScreenMgr.instance.screenHeight,this.btn1Bg.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickBtn1,this),this.btn2Bg.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickBtn2,this),this.btn3Bg.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickBtn3,this),this.init(),this.saveData(),this.initStar()},t.prototype.initStar=function(){var e=[this.star1,this.star2,this.star3];for(var t in e)e[t].visible=!1;for(var i=0;i<this.star;i++)e[i].visible=!0},t.prototype.saveData=function(){},t.prototype.init=function(){this.numLabel.text=GameData.curScore.toString()},t.prototype.clickBtn1=function(){SceneMgr.gotoIndex()},t.prototype.clickBtn2=function(){SceneMgr.rePlayLv()},t.prototype.clickBtn3=function(){GameData.initLvData(GameData.enterLv+1),SceneMgr.gotoGame()},t}(eui.Component);__reflect(WinUI.prototype,"WinUI");var Net=function(){function e(){this._url=null,this._url="http://localhost:63342/workerMan/Game/Test.php"}return e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},e.prototype.sendHttpRequest=function(e,t){void 0===t&&(t=null);var i=new egret.URLLoader;i.addEventListener(egret.Event.COMPLETE,this.onLoadComplete,this),i.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onLoadError,this),i.dataFormat=egret.URLLoaderDataFormat.TEXT;var n=JSON.stringify(t),r=new egret.URLVariables;r.variables={msg:e,data:n};var o=new egret.URLRequest;o.method=egret.URLRequestMethod.POST,o.url=this._url,o.data=r,i.load(o)},e.prototype.onLoadError=function(){console.log("服务器连接失败")},e.prototype.onLoadComplete=function(e){var t=e.target,i=t.data;egret.log("返回数据："+i)},e.instance=null,e}();__reflect(Net.prototype,"Net");var NetError=function(e){function t(t){return e.call(this)||this}return __extends(t,e),t}(eui.Component);__reflect(NetError.prototype,"NetError");var NetMsg=function(){function e(){}return e.arr={chat:{send:"chat.sendMsg"}},e}();__reflect(NetMsg.prototype,"NetMsg");var NetWait=function(e){function t(){return e.call(this)||this}return __extends(t,e),t}(eui.Component);__reflect(NetWait.prototype,"NetWait");var Test=function(e){function t(){var t=e.call(this)||this;return t.skinName="TestSkin",t.addEventListener(egret.Event.ADDED_TO_STAGE,t.addStage,t),t}return __extends(t,e),t.prototype.addStage=function(){this.btn.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBtn,this)},t.prototype.initMusic=function(){var e=RES.getRes("bg_mp3");e&&e.play(0,1)},t.prototype.onBtn=function(){this.label.strokeColor=65280,this.label.stroke=1;var e=RES.getRes("bg_mp3");e&&e.play(0,1)},t}(eui.Component);__reflect(Test.prototype,"Test");var Cannon=function(e){function t(){var t=e.call(this)||this;return t.skinName="",t.addEventListener(egret.Event.ADDED_TO_STAGE,t.addStage,t),t}return __extends(t,e),t.prototype.addStage=function(){},t.prototype.shoot=function(e,t){var i=90,n=egret.Tween.get(this.cannon);n.to({rotation:i},200).call(function(){},this)},t.prototype.changeCannon=function(){this.cannon.source="";var e=RES.getRes("");this.cannon.anchorOffsetX=e.textureWidth/2,this.cannon.anchorOffsetY=e.textureHeight/2},t}(eui.Component);__reflect(Cannon.prototype,"Cannon");var Fish=function(e){function t(){var t=e.call(this)||this;return t.initView(),t}return __extends(t,e),t.prototype.initView=function(){this.mc=Animation.makeAni("fish4"),this.mc&&(this.mc.gotoAndPlay("run",-1),this.addChild(this.mc));egret.Tween.get(this)},t.prototype.swimming=function(){var e=egret.Tween.get(this,{loop:!0});e.to({x:480,y:800},4e3)},t.prototype.isUnderAtk=function(e,t){this.hitTestPoint(e,t)},Object.defineProperty(t.prototype,"factor",{get:function(){return 0},set:function(e){this.x=(1-e)*(1-e)*100+2*e*(1-e)*300+e*e*100,this.y=(1-e)*(1-e)*100+2*e*(1-e)*300+e*e*500},enumerable:!0,configurable:!0}),t}(eui.Component);__reflect(Fish.prototype,"Fish");var FishScene=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(egret.Event.ADDED_TO_STAGE,t.addStage,t),t}return __extends(t,e),t.prototype.addStage=function(){var e=new Fish;e.x=0,e.y=0,e.swimming(),this.addChild(e),this.initBg(),this.initCannon()},t.prototype.initBg=function(){var e=new eui.Image("scenebg1_jpg");e.width=Display.winSize.width,e.height=Display.winSize.height,this.addChild(e)},t.prototype.initCannon=function(){},t}(eui.Component);__reflect(FishScene.prototype,"FishScene");var EllipseShapData=function(){function e(){this.ra=0,this.rb=0}return e}();__reflect(EllipseShapData.prototype,"EllipseShapData");var PolygonShapData=function(){function e(){this.pointArray=[]}return e}();__reflect(PolygonShapData.prototype,"PolygonShapData");var PolyLineShapData=function(){function e(){this.pointArray=[]}return e}();__reflect(PolyLineShapData.prototype,"PolyLineShapData");var RectangleShapData=function(){function e(){this.width=0,this.height=0}return e}();__reflect(RectangleShapData.prototype,"RectangleShapData");var TiledScene=function(e){function t(){var t=e.call(this)||this;return t.map=null,t.prePoint={x:0,y:0},t.initBg(),t.onLoadMap(),t.touchEnabled=!0,t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,t.onTouchBegan,t),t.addEventListener(egret.TouchEvent.TOUCH_MOVE,t.onTouchMoved,t),t.addEventListener(egret.TouchEvent.TOUCH_END,t.onTouchEnd,t),t.addEventListener(egret.Event.ADDED_TO_STAGE,t.addToStage,t),t}return __extends(t,e),t.prototype.addToStage=function(){},t.prototype.initBg=function(){var e=new egret.Shape;e.graphics.beginFill(12700671),e.graphics.drawRect(0,0,Display.winSize.width,Display.winSize.height),e.graphics.endFill(),this.addChild(e)
},t.prototype.onLoadMap=function(){var e="resource/tiled/map.tmx",t=new egret.URLLoader;t.dataFormat=egret.URLLoaderDataFormat.TEXT,t.addEventListener(egret.Event.COMPLETE,function(t){var i=egret.XML.parse(t.target.data);this.map=new tiled.TMXTilemap(2e3,2e3,i,e),this.map.render(),this.map.addEventListener(tiled.TMXImageLoadEvent.ALL_IMAGE_COMPLETE,this.onLoaded,this),this.addChildAt(this.map,1)},this),t.load(new egret.URLRequest(e))},t.prototype.onLoaded=function(){if(this.map){this.map.visible=!0;var e=this.map.getLayers();for(var t in e){var i=e[t],n=i.__class__;if("tiled.TMXLayer"==n){var r=i;r.getTile(0,0),r.getTileId(0,0)}else if("tiled.TMXObjectGroup"==n)for(var o=i,a=o.getObjectCount(),s=0;a>s;s++){var l=o.getObjectByIndex(s);if(l.isEllipse){var h=new EllipseShapData;h.pos=new egret.Point(l.x,l.y),h.ra=l.width,h.rb=l.height}else l.isImage||l.isPolygon||l.isPolyLine}}var c=this.map.getObjects();for(var t in c)var u=c[t],d=0}},t.prototype.onTouchBegan=function(e){this.prePoint.x=e.stageX,this.prePoint.y=e.stageY},t.prototype.onTouchEnd=function(e){},t.prototype.onTouchMoved=function(e){if(this.map){var t=e.stageX,i=e.stageY,n=t-this.prePoint.x,r=i-this.prePoint.y,o=this.map.x,a=this.map.y;this.map.x=o+n,this.map.y=a+r,this.prePoint.x=t,this.prePoint.y=i}},t}(egret.DisplayObjectContainer);__reflect(TiledScene.prototype,"TiledScene");var Animation=function(){function e(){}return e.makeAni=function(e){var t=RES.getRes(e+"_json"),i=RES.getRes(e+"_png");if(t&&i){var n=new egret.MovieClipDataFactory(t,i),r=new egret.MovieClip(n.generateMovieClipData("ani"));return r.frameRate=10,r}return egret.log("[Animation] �����ļ������� "+e),null},e.makeParticle=function(e){},e}();__reflect(Animation.prototype,"Animation");var CallBackFunc=function(){function e(){this.callBack=null,this.thisObj=null,this.args=[]}return e.prototype.handler=function(e,t,i){return this.callBack=e,this.thisObj=t,this.args=i,this},e.prototype.exec=function(e){return void 0===e&&(e=null),e&&(this.args=e),null!=this.callBack&&null!=this.thisObj?this.callBack.apply(this.thisObj,this.args):void 0},e}();__reflect(CallBackFunc.prototype,"CallBackFunc");var Director=function(){function e(){this.stackLayer=[],this.gameLayer=null,this.netLayer=null,this.guidLayer=null}return e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},e.prototype.initWithMain=function(e){null==this.gameLayer&&(this.gameLayer=e),this.netLayer=new NetLayerUtil,Display.stage.addChildAt(this.netLayer,9),this.guidLayer=new GuidLayerUtil,Display.stage.addChildAt(this.guidLayer,10)},e.prototype.repleaceScene=function(e){null!=this.gameLayer&&null!=e&&(this.gameLayer.removeChildren(),this.gameLayer.addChild(e))},e.prototype.pushScene=function(e){null!=this.gameLayer&&null!=e&&(this.gameLayer.addChild(e),this.stackLayer.push(e))},e.prototype.popScene=function(){if(null!=this.gameLayer){var e=this.stackLayer.length;if(e>0){var t=this.stackLayer[e-1];t.parent==this.gameLayer&&(this.gameLayer.removeChild(t),Util.removeByElements(this.stackLayer,t))}}},e.prototype.addGuidLayer=function(){this.guidLayer.addGuidLayer()},e.prototype.getCurGuidLayer=function(){return this.guidLayer.curLayer},e.prototype.cleanGuidLayer=function(){this.guidLayer.cleanGuidLayer()},e.prototype.addNetWaitLayer=function(){this.netLayer.addWaitLayer()},e.prototype.addNetOutLineLayer=function(){this.netLayer.addOutLineLayer()},e.prototype.addNetErrorLayer=function(){this.netLayer.addErrorLayer()},e.prototype.cleanNetLayer=function(){this.netLayer.cleanLayer()},e.instance=null,e}();__reflect(Director.prototype,"Director");var Display=function(){function e(){}return Object.defineProperty(e,"winSize",{get:function(){return this._winSize.width=egret.MainContext.instance.stage.stageWidth,this._winSize.height=egret.MainContext.instance.stage.stageHeight,this._winSize.cx=this._winSize.width/2,this._winSize.cy=this._winSize.height/2,this._winSize},enumerable:!0,configurable:!0}),Object.defineProperty(e,"stage",{get:function(){return egret.MainContext.instance.stage},enumerable:!0,configurable:!0}),e._winSize={width:0,height:0,cx:0,cy:0},e}();__reflect(Display.prototype,"Display");var GuidLayerUtil=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.addGuidLayer=function(){},t.prototype.cleanGuidLayer=function(){this.removeChildren()},t}(egret.DisplayObjectContainer);__reflect(GuidLayerUtil.prototype,"GuidLayerUtil");var NetLayerUtil=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.addWaitLayer=function(){this.removeChildren();var e=new NetWait;this.curLayer=e,this.addChild(e)},t.prototype.addOutLineLayer=function(){this.removeChildren();var e=new NetError("���˺����������ط���¼,�Ƿ����µ�¼?");this.curLayer=e,this.addChild(e)},t.prototype.addErrorLayer=function(){this.removeChildren();var e=new NetError;this.curLayer=e,this.addChild(e)},t.prototype.cleanLayer=function(){this.removeChildren()},t}(egret.DisplayObjectContainer);__reflect(NetLayerUtil.prototype,"NetLayerUtil");var ScreenMgr=function(){function e(){}return Object.defineProperty(e,"instance",{get:function(){return this._instance||(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"screenWidth",{get:function(){return egret.MainContext.instance.stage.stageWidth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"screenHeight",{get:function(){return egret.MainContext.instance.stage.stageHeight},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"designWidth",{get:function(){return this._designWidth},set:function(e){this._designWidth=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"designHeight",{get:function(){return this._designHeight},set:function(e){this._designHeight=e},enumerable:!0,configurable:!0}),e}();__reflect(ScreenMgr.prototype,"ScreenMgr");var Tips=function(e){function t(){var t=e.call(this)||this;return t.bg=new eui.Image,t.bg.source=RES.getRes("tips_png"),t.bg.scale9Grid=new egret.Rectangle(55,12,9,4),t.addChild(t.bg),t.width=121,t.height=30,t.anchorOffsetX=t.width/2,t.anchorOffsetY=t.height/2,t.label=new eui.Label,t.addChild(t.label),t.x=Display.winSize.width/2,t.y=Display.winSize.height-100,egret.MainContext.instance.stage.addChildAt(t,1e5),t}return __extends(t,e),t.prototype.show=function(e){this.label.text=e,this.label.anchorOffsetX=this.label.width/2,this.label.anchorOffsetY=this.label.height/2,this.label.x=this.width/2,this.label.y=this.height/2,this.bg.width=this.label.width+50,this.bg.height=this.label.height+20,this.bg.anchorOffsetX=this.bg.width/2,this.bg.anchorOffsetY=this.bg.height/2,this.bg.x=this.width/2,this.bg.y=this.height/2;var t=egret.Tween.get(this);t.to({x:Display.winSize.width/2,y:Display.winSize.height-200},1500,egret.Ease.backOut).call(this.callback,this)},t.prototype.callback=function(){this.parent.removeChild(this)},t}(egret.DisplayObjectContainer);__reflect(Tips.prototype,"Tips");var Util=function(){function e(){}return e.removeByElements=function(e,t){for(var i=-1,n=e.length,r=0;n>r;r++)if(e[r]==t){i=r;break}i>=0&&e.splice(i,1)},e.formatString=function(e){for(var t,i,n,r,o,a=0,s=e[a++],l=[],h="";s;){if(i=/^[^\x25]+/.exec(s))l.push(i[0]);else if(i=/^\x25{2}/.exec(s))l.push("%");else{if(!(i=/^\x25(?:(\d+)\$)?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(s)))throw"Huh ?!";if(null==(t=e[i[1]||a++])||void 0==t)throw"Too few arguments.";if(/[^s]/.test(i[7])&&"number"!=typeof t)throw"Expecting number but found "+typeof t;switch(i[7]){case"b":t=t.toString(2);break;case"c":t=String.fromCharCode(t);break;case"d":t=parseInt(t);break;case"e":t=i[6]?t.toExponential(i[6]):t.toExponential();break;case"f":t=i[6]?parseFloat(t).toFixed(i[6]):parseFloat(t);break;case"o":t=t.toString(8);break;case"s":t=(t=String(t))&&i[6]?t.substring(0,i[6]):t;break;case"u":t=Math.abs(t);break;case"x":t=t.toString(16);break;case"X":t=t.toString(16).toUpperCase()}t=/[def]/.test(i[7])&&i[2]&&t>=0?"+"+t:t,r=i[3]?"0"==i[3]?"0":i[3].charAt(1):" ",o=i[5]-String(t).length-h.length,n=i[5]?this.str_repeat(r,o):"",l.push(h+(i[4]?t+n:n+t))}s=s.substring(i[0].length)}return l.join("")},e.str_repeat=function(e,t){return new Array(t+1).join(e)},e}();__reflect(Util.prototype,"Util"),window.Main=Main,window.IndexButton=IndexButton;